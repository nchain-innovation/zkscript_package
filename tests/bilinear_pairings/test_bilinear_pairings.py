from dataclasses import dataclass

import pytest
from elliptic_curves.fields.cubic_extension import CubicExtension
from elliptic_curves.fields.quadratic_extension import QuadraticExtension
from elliptic_curves.instantiations.bls12_381.bls12_381 import BLS12_381
from elliptic_curves.instantiations.bls12_381.bls12_381 import NON_RESIDUE_FQ2 as NON_RESIDUE_FQ2_BLS12_381
from elliptic_curves.instantiations.bls12_381.bls12_381 import Fq as Fq_bls12_381
from elliptic_curves.instantiations.bls12_381.bls12_381 import Fq2 as Fq2_bls12_381
from elliptic_curves.instantiations.bls12_381.bls12_381 import Fq6 as Fq6_bls12_381
from elliptic_curves.instantiations.bls12_381.bls12_381 import Fq12 as Fq12_bls12_381
from elliptic_curves.instantiations.bls12_381.bls12_381 import q as q_bls12_381
from elliptic_curves.instantiations.bls12_381.parameters import NON_RESIDUE_FQ4 as NON_RESIDUE_FQ4_BLS12_381
from elliptic_curves.instantiations.mnt4_753.mnt4_753 import MNT4_753
from elliptic_curves.instantiations.mnt4_753.mnt4_753 import Fq as Fq_mnt4_753
from elliptic_curves.instantiations.mnt4_753.mnt4_753 import Fq2 as Fq2_mnt4_753
from elliptic_curves.instantiations.mnt4_753.mnt4_753 import Fq4 as Fq4_mnt4_753
from elliptic_curves.instantiations.mnt4_753.mnt4_753 import q as q_mnt4_753
from tx_engine import Context, Script

from src.zkscript.bilinear_pairings.bls12_381.bls12_381 import bls12_381
from src.zkscript.bilinear_pairings.bls12_381.fields import fq12cubic_script as fq12cubic_script_bls12_381
from src.zkscript.bilinear_pairings.bls12_381.final_exponentiation import (
    final_exponentiation as final_exponentiation_bls12_381,
)
from src.zkscript.bilinear_pairings.bls12_381.line_functions import line_functions as line_functions_bls12_381
from src.zkscript.bilinear_pairings.bls12_381.miller_output_operations import (
    miller_output_ops as miller_output_ops_bls12_381,
)
from src.zkscript.bilinear_pairings.mnt4_753.final_exponentiation import (
    final_exponentiation as final_exponentiation_mnt4_753,
)
from src.zkscript.bilinear_pairings.mnt4_753.line_functions import line_functions as line_functions_mnt4_753
from src.zkscript.bilinear_pairings.mnt4_753.miller_output_operations import (
    miller_output_ops as miller_output_ops_mnt4_753,
)
from src.zkscript.bilinear_pairings.mnt4_753.mnt4_753 import mnt4_753
from src.zkscript.script_types.stack_elements import StackEllipticCurvePoint, StackFiniteFieldElement
from src.zkscript.script_types.unlocking_keys.miller_loops import (
    MillerLoopUnlockingKey,
    TripleMillerLoopUnlockingKey,
)
from src.zkscript.script_types.unlocking_keys.pairings import (
    SinglePairingUnlockingKey,
    TriplePairingUnlockingKey,
)
from src.zkscript.util.utility_scripts import nums_to_script
from tests.bilinear_pairings.util import (
    check_constant,
    generate_unlock,
    generate_verify,
    modify_verify_modulo_check,
    save_scripts,
)


@dataclass
class Bls12381:
    # Define Fq, Fq2, Fq4, Fq12 and Fq12Cubic
    q = q_bls12_381
    Fq = Fq_bls12_381
    Fq2 = Fq2_bls12_381
    Fq4 = QuadraticExtension(base_field=Fq2, non_residue=NON_RESIDUE_FQ2_BLS12_381)
    Fq6 = Fq6_bls12_381
    Fq12 = Fq12_bls12_381
    Fq12Cubic = CubicExtension(base_field=Fq4, non_residue=Fq4.from_list(NON_RESIDUE_FQ4_BLS12_381))
    # G1 & G2
    g1_curve = BLS12_381.g1_curve
    g2_curve = BLS12_381.g2_curve
    # Define scripts run in tests
    test_script_line_functions = line_functions_bls12_381
    test_script_miller_output_ops = miller_output_ops_bls12_381
    test_script_final_exponentiation = final_exponentiation_bls12_381
    test_script_pairing = bls12_381
    test_script_cubic_to_quadratic = fq12cubic_script_bls12_381
    # Indices of elements to select from sparse multiplications/line evaluations
    ix_line_evaluation = [0, 1, 2, 8, 9]
    ix_line_eval_times_eval = [0, 1, 2, 3, 6, 7, 8, 9, 10, 11]
    ix_line_eval_times_eval_times_eval = list(range(12))
    ix_line_eval_times_eval_times_eval_times_eval = list(range(12))
    ix_miller_output = list(range(12))
    # Parameters of the curve
    exp_miller_loop = BLS12_381.miller_loop_engine.exp_miller_loop
    val_miller_loop = BLS12_381.miller_loop_engine.val_miller_loop
    # Define filename for saving scripts
    filename = "bls12_381"

    test_data = {
        "test_cubic_to_quadratic": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2233518172374441102685284131667975693718331404008896853728732758880479429609363743705346696423805488418600424580674
                            ),
                            Fq(
                                3572881249546571266110202669125961372055771026476195108348710978289379786899795490485025479133734490084561293477830
                            ),
                        ),
                        Fq2(
                            Fq(
                                2577908807222122184596397070784723804301108182353329940145512055098990715337504966430432893833985088358149029869637
                            ),
                            Fq(
                                3636215205375037545849985262616569562011855559718499702882525978833801769039679062022359024705790488287388971182280
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                425119504379439731090733489751074082374375946362734098706547687801624084085252177970570919745062947311019454704089
                            ),
                            Fq(
                                3636620826153432761220507049517678978632821887152993241540248678812057389590090526526510772187175721365170985961031
                            ),
                        ),
                        Fq2(
                            Fq(
                                3329160861362162857038694502454505119555693124698582788644288336530257681992808975357208978893382921333153432548274
                            ),
                            Fq(
                                241006850601890818673720022778337484455479377506451094946644197997469764215147449031819178414169267314392908002569
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                2359565806274708441688450700064513455713466355242877646561339393164937969124368955627235041157852371824822047080046
                            ),
                            Fq(
                                1060569452816535499037297789793835093883761142854978271299280296821736554900475900449885736525840285898754591503484
                            ),
                        ),
                        Fq2(
                            Fq(
                                1974479300082843025122703118511053891811159983240791485068976835787331393196898609830386140050667871611926096012608
                            ),
                            Fq(
                                3709813765856428038007352777618045996877811086060085966092318557390348514824557566105677377287631023920311114155517
                            ),
                        ),
                    ),
                ),
                "expected": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                2233518172374441102685284131667975693718331404008896853728732758880479429609363743705346696423805488418600424580674
                            ),
                            Fq(
                                3572881249546571266110202669125961372055771026476195108348710978289379786899795490485025479133734490084561293477830
                            ),
                        ),
                        Fq2(
                            Fq(
                                2359565806274708441688450700064513455713466355242877646561339393164937969124368955627235041157852371824822047080046
                            ),
                            Fq(
                                1060569452816535499037297789793835093883761142854978271299280296821736554900475900449885736525840285898754591503484
                            ),
                        ),
                        Fq2(
                            Fq(
                                3329160861362162857038694502454505119555693124698582788644288336530257681992808975357208978893382921333153432548274
                            ),
                            Fq(
                                241006850601890818673720022778337484455479377506451094946644197997469764215147449031819178414169267314392908002569
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                425119504379439731090733489751074082374375946362734098706547687801624084085252177970570919745062947311019454704089
                            ),
                            Fq(
                                3636620826153432761220507049517678978632821887152993241540248678812057389590090526526510772187175721365170985961031
                            ),
                        ),
                        Fq2(
                            Fq(
                                2577908807222122184596397070784723804301108182353329940145512055098990715337504966430432893833985088358149029869637
                            ),
                            Fq(
                                3636215205375037545849985262616569562011855559718499702882525978833801769039679062022359024705790488287388971182280
                            ),
                        ),
                        Fq2(
                            Fq(
                                1974479300082843025122703118511053891811159983240791485068976835787331393196898609830386140050667871611926096012608
                            ),
                            Fq(
                                3709813765856428038007352777618045996877811086060085966092318557390348514824557566105677377287631023920311114155517
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_line_evaluation": [
            # Test with P = Q
            {
                "point_p": g1_curve(
                    Fq(
                        3552880022460696608572256477880253350444280868160839581990288141592117480196756619592352637820697840674774297115877
                    ),
                    Fq(
                        2709269896970082145263991252530787639675288215483386037402360697422131498755459835397680388437951814706734875643115
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            984776368677483480818219616795673488144052234621116179324278387343806296999922800894817879352551612698077686668338
                        ),
                        Fq(
                            2910882053928552595202949074863601961183479764611021456335838186443070488770971010674378272747725624889892515257899
                        ),
                    ),
                    Fq2(
                        Fq(
                            1928269879724727550376812075216409388528739040726384555170646411977190342564954532894557471051610883600163912044803
                        ),
                        Fq(
                            2513390629329149808754371575718682444449570148791868258861771317152678656233301021842319237264279438038780344045485
                        ),
                    ),
                    infinity=False,
                ),
                "lam": Fq2(
                    Fq(
                        735271569487924019958498380969637026897130200191012182143695285623641678456430717041032209334414646649223765264357
                    ),
                    Fq(
                        1729344257490419266462757168288630514244233016708848616824879952002122924097975821132827002438392473483611370790735
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2484258104365666600348150727648241171453217901867610042166923842891674311294186702791443183294189757118175589181247
                            ),
                            Fq(
                                986142048174879428048997888604884591134311948853356883368072287710979360652244294729565379252771578937646116051422
                            ),
                        ),
                        Fq2(
                            Fq(
                                2709269896970082145263991252530787639675288215483386037402360697422131498755459835397680388437951814706734875643115
                            ),
                            Fq(0),
                        ),
                    ),
                    Fq4.zero(),
                    Fq4(
                        Fq2(
                            Fq(
                                3200990461657859449606222339271211619411310963382640456694159717045967779752815107205125035336175775742669988070192
                            ),
                            Fq(
                                2863318569133846858032373808354908983319159791305942600129687785156030603632304703316759443461791391741306069671198
                            ),
                        ),
                        Fq2.zero(),
                    ),
                ),
            },
            # Test with P != Q
            {
                "point_p": g1_curve(
                    Fq(
                        1683171493390355382204633683126174532988464948053077287746737091245592058012152423946670111217437157263237169749181
                    ),
                    Fq(
                        620268835097054848659572119983618307676849664103440655181240227964614701904962519294478749933715758037984563342941
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            1964359303875367870370303854971717930927375079775382039874315751229285238332401060664758867999880211416570083034305
                        ),
                        Fq(
                            2967407357407674524129293464034652319083009165278269673098157797130556305298232145701256514476109359420990329016923
                        ),
                    ),
                    Fq2(
                        Fq(
                            1087613881021087004865347538946270489442137108866957418720080908467743589168039518709865855400784421506050530445072
                        ),
                        Fq(
                            1061163051113526495677945288382158989286653614256476717250781491340153161832860750777983526991754062498195527438202
                        ),
                    ),
                    infinity=False,
                ),
                "lam": Fq2(
                    Fq(
                        2807236450796085800354596544208173744314334914225982792639859564677046213704425856278481161969026777037556389156210
                    ),
                    Fq(
                        119276815192268416183892776721907073517531364155372522909823959209077888026523016303264576272553297390267560113325
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3446714081886934326057697873732828339051498845073192051864307198026807370424078179773544704856932372705303588493371
                            ),
                            Fq(
                                2237884283770358755299341366813582531646498073549745441816531451061804439999096923445825357155780467161955086650794
                            ),
                        ),
                        Fq2(
                            Fq(
                                620268835097054848659572119983618307676849664103440655181240227964614701904962519294478749933715758037984563342941
                            ),
                            Fq(0),
                        ),
                    ),
                    Fq4.zero(),
                    Fq4(
                        Fq2(
                            Fq(
                                1021150652613287475116894767390827407893777328120761959090254423510444119409924371361352483661041726355624435815991
                            ),
                            Fq(
                                2444654633489406114883201556913784012204760896348200430656433288659351917251367778951446873994580618344445440390429
                            ),
                        ),
                        Fq2.zero(),
                    ),
                ),
            },
        ],
        "test_line_eval_times_eval": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3056460564517411154338050951923002000829880043515881504915279271895882987159589365563786920463125641397531695063135
                            ),
                            Fq(
                                2788583893247032345461944583418934417087248339053425456634397025195399503262131001035782525328796350121458692588996
                            ),
                        ),
                        Fq2(
                            Fq(
                                353405194025118326719555238477901726411993318684945951089248350143665821193454033001620813510684455672744464950354
                            ),
                            Fq(0),
                        ),
                    ),
                    Fq4.zero(),
                    Fq4(
                        Fq2(
                            Fq(
                                641017225206359819299001882589487382332870882037684366553694902824562706486675481455804105254613570177347384533995
                            ),
                            Fq(
                                2815099474701630630977847994847481691709288481580491640648053672257704126457692210964821482436052473897603425613791
                            ),
                        ),
                        Fq2.zero(),
                    ),
                ),
                "y": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                1272389303389219409586822196715592775766829068365615325509357050883548307035835821047158487565355427899705368898029
                            ),
                            Fq(
                                1485121108985934334398695563903519931263344018585499329741190293025623358175248009985982207586335133132648765040498
                            ),
                        ),
                        Fq2(
                            Fq(
                                2002696704548505868286282015906873784664542521188960166205828149329175971734550974445352686307595427992746520693376
                            ),
                            Fq(0),
                        ),
                    ),
                    Fq4.zero(),
                    Fq4(
                        Fq2(
                            Fq(
                                2595699715966030516958962246152323300662957416180226325163762242528891334181821955727195363391988138375370286187147
                            ),
                            Fq(
                                671522543231929032341340429670328223642422141880982187880399572704735060864607076562161275720473823413730284444538
                            ),
                        ),
                        Fq2.zero(),
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                1914350559802028040621105127429688305544524991365913111638467767476733827673830766125984052433805937592071857035420
                            ),
                            Fq(
                                2197904425100464668424544869709835818061463620392321350850426623740263405469699404432871614508715293616618933232256
                            ),
                        ),
                        Fq2(
                            Fq(
                                156836692964510230074021148987983325290973173030989688101572299158411577605789884531026723579461953705007611059750
                            ),
                            Fq(
                                32873156539833751631667148197088761147255885194445669591448203503618792925569788713465116423122741624939028442519
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2.zero(),
                        Fq2(
                            Fq(
                                3628277363548785682308224822473116447862626534599981465588735964684867453435562344945208559376815983269072996405567
                            ),
                            Fq(
                                869152251912262074770310357054077127920406723388880421985527379171465954673676348026166280874126716781409928727394
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                435671139329015304926155779989440676611832521273576397141728018174154402255127132403911215608673704699493776717477
                            ),
                            Fq(
                                1598641647521203331603650790222786387465350908476983190410811613999669487069556172969574069442690051500176960291184
                            ),
                        ),
                        Fq2(
                            Fq(
                                305269762408928849201967668765396054477307781873570558173923947206483501767036197976024560283034376407393358287234
                            ),
                            Fq(
                                2229106794473301485320858363980870973083497751153484317914564837247491653718058762988707789411832994261442317216237
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_line_eval_times_eval_times_eval": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2428517356370160215418088690521471175051595102926663955222730906027402279811119334487818869593829961576829502672591
                            ),
                            Fq(
                                193044235407331001377637727956750442568269627240989090172004349542197973940651074868115768374654853617598758230141
                            ),
                        ),
                        Fq2(
                            Fq(
                                1583517349250556082842021194166630949840711789065204936120783766607625854239876467672448440027035194641767583507364
                            ),
                            Fq(0),
                        ),
                    ),
                    Fq4.zero(),
                    Fq4(
                        Fq2(
                            Fq(
                                424495849014588501493549568791129774890420163894882341237887161160248613524742694268820397930286958697517705332815
                            ),
                            Fq(
                                3101670078316319512323993428816446683042096705705059026825028450602383190771238778372166184670725113666597548005405
                            ),
                        ),
                        Fq2.zero(),
                    ),
                ),
                "y": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                691436951382232946274977841980159986575476047185270336265613003184385605314294227264840028059473068365702703990354
                            ),
                            Fq(
                                512665290404746632179338087383307979548132524921710073612268795159975890335937014925927397334990975685613731717089
                            ),
                        ),
                        Fq2(
                            Fq(
                                333886299895680976757252685575475882804393103955205590804880757730240365835734034312043352440857413957644176194872
                            ),
                            Fq(
                                3342128717342846179759202377502695733183471787092372007402937304965063812169088415075450905909971353928323453758826
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2.zero(),
                        Fq2(
                            Fq(
                                22917595422914560760592521676608246940114056307589799029848993786349612284199954805260420097362232271977287282856
                            ),
                            Fq(
                                1466770939261346354261111454321197941652607040199758741985407157424768755097579519472853295709124468525144191392988
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                20145055283236245951319710817152201462704992131808790652190562813877766502534127117168078135870125798449617348864
                            ),
                            Fq(
                                3378543795660398966907247691644378365348842705530425167919740410138686410818909646326685549118870824199683498576913
                            ),
                        ),
                        Fq2(
                            Fq(
                                3440298207790208115447397523386700903778943657149381446117638476116273567208992311184892306437368905407544281023430
                            ),
                            Fq(
                                674072394659213159748301180946857089926156522077222816044438616190979335851108942375291669224615930034343480024513
                            ),
                        ),
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                1066694265835905437671871468246248845854815512890832080156907769884530027392660937923120230986985014740993492495621
                            ),
                            Fq(
                                807181536600113304696689297266050031630903424979953111608613766425487384010726856076237147984825920532004987264041
                            ),
                        ),
                        Fq2(
                            Fq(
                                3556544023235562917239814570675896313263551753004131293507317526724138262672618586956290928885444887160853789564409
                            ),
                            Fq(
                                3803556400183403904741179254469736116475816817134179585655038543505189273141004061352475959132269465659231329140873
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                51512367705043767356255222496876770170562707956050276970559940090415662633799802990433944079313707809425568116649
                            ),
                            Fq(
                                1180212824374491199844523370284751932334857133078164895432775647751821349272839427930200388683221337383008638949290
                            ),
                        ),
                        Fq2(
                            Fq(
                                3864493022625030267273713291839202820756625139773921143769141920537305552957248664541401697590828650776054902557179
                            ),
                            Fq(
                                3748612387470179511911349252276480100245878505933382542887671861923352594979768963816113747939990323167454986528824
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1831966350865906374477692531927264288185189558340514739790652237489140535216316995926164329590328122388174845390800
                            ),
                            Fq(
                                2476485872496629306637835246112635609536316954325206083786350910629847994709047036254589349675097769665958765883645
                            ),
                        ),
                        Fq2(
                            Fq(
                                2231839097318953622014936228860746227896260397786585036809924002254569111490762030247977437008512897533154741405604
                            ),
                            Fq(
                                1840390095216038348871347423337364557829069296848995032734970927165110996268637678795054771854936015453142746046589
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_line_eval_times_eval_times_eval_times_eval": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3148563918921573043255646315929409403992218006180316846089031037037659582357759133918470517346068904483338729261921
                            ),
                            Fq(
                                1995036575569538647169135634884231722569600215770779403912234886619063447438530259283148949381111466265786370087492
                            ),
                        ),
                        Fq2(
                            Fq(
                                473688949385493001856013685768740010058254399444099614949564845827326474903171829965691530745761323638754177631112
                            ),
                            Fq(
                                3497380129975473563767227953423330807401080054342252446652808806097832732931369211439499706017405535977155778490048
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2.zero(),
                        Fq2(
                            Fq(
                                679316296766098337208670734144306591365089786709424157174603586428844295254482225913774058660490147479335486502506
                            ),
                            Fq(
                                1306239613419657141231254171700579097146311784649227359883745627485678955828343476717197885034194317125255562832441
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                473156892410552627448438954706942721218581821947368242471821157640940127699570055704974987499871516291750549108309
                            ),
                            Fq(
                                2758760384507827646910330014562675419265303742235809334425757919128236444399317462626122710997399540019241692028480
                            ),
                        ),
                        Fq2(
                            Fq(
                                1114214237233140618398179250290798299198286175559858447780613766048863369682086195973147795806060122970254260920867
                            ),
                            Fq(
                                3444182106830774171184271919855079798356280279269164909747934421158475610436989088309355622773516610655632248007129
                            ),
                        ),
                    ),
                ),
                "y": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3615730791762225206019838614395254523528492049885281057638980312366559515867001477926167566321432333332803863419433
                            ),
                            Fq(
                                3927556822460755742369607722871499118761040430447782405931244571657165535522331253072194966114754933811972808596924
                            ),
                        ),
                        Fq2(
                            Fq(
                                2395196113859771835047051874271815049287302981343014804659572585848244750228992056383011675933104043113216618108688
                            ),
                            Fq(
                                2877631247944646302985004445242437985336337777528181938848671281335449943589594699148750111766064256468573199152197
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2.zero(),
                        Fq2(
                            Fq(
                                3526445379660538580209304466762627383144908950551602289836235534313606865617335958207997567158525684073156663425570
                            ),
                            Fq(
                                460628508910924769368665386485853284361467439478190552471027874810794124652306085671655651162378355547480336992181
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1174617331397934864518746377697509087857727225022663096291745432274170010234083779936928626256498890078066926607309
                            ),
                            Fq(
                                1385906594539487007910771621523623823504877776185413904838227720228163077188861136186299634642649483393858508129738
                            ),
                        ),
                        Fq2(
                            Fq(
                                3101539313821383196054760576207995940924544596371705535777185813517414644301067092442884076333652871648378749001894
                            ),
                            Fq(
                                2442408014222518667044220513481902160114383378441144020657294542188747086967995477126487566712050396202437481918664
                            ),
                        ),
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3925690634260383860292732282565161183504020553954685092485668381947065539783111061827811538204675040952006175249947
                            ),
                            Fq(
                                2265352903715584128659069870213862206048423221081238928474333226028847770766743432875601787440432254289466071117981
                            ),
                        ),
                        Fq2(
                            Fq(
                                593779088364720552355730241323564420491700070041577049147425936761081898543483093993100314001295954402053591416907
                            ),
                            Fq(
                                3943924001554010542199726907934969985618947562570220478542892863235511937690475976490201841895075895267551246924644
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1996181481414633095853058049369823144798246337329215169955292185227325093383861890573826597427763988203657899664428
                            ),
                            Fq(
                                736141030387786839863263912274323645814218893943271347192310784354577983295643245495778710401106417777465777653729
                            ),
                        ),
                        Fq2(
                            Fq(
                                2674748498803845016794888422223851273362221135049386805740496373459528083619155827355265999267667138087079489785041
                            ),
                            Fq(
                                2004093955112260972644709357988724572619615048190292758373653539803981478885156861674964167401134462042281742143990
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                2966744313922806030052182708325038264937474724828194769825547025760751807384023220339918897781249363043077657603030
                            ),
                            Fq(
                                3670887332852869707395991066384989766198317469399317532574495720727574003300296749361838631963406187751757227552
                            ),
                        ),
                        Fq2(
                            Fq(
                                2749188158563467539179483207134277712377937647886393210295556900513060494038138323087038157616187336104053031852299
                            ),
                            Fq(
                                3672969552259894827025647939911514597116213040181366701626525877125866707720419992875994605920047528965783254492893
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_line_eval_times_eval_times_eval_times_eval_times_eval_times_eval": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3083406441043261433201982564595469839335262111798912566011899843340248226275134389435745257233041228051285222364242
                            ),
                            Fq(
                                3615238050759790647963072304355184178047659534225257692968230207242050014727592572873037473910346462170184258760412
                            ),
                        ),
                        Fq2(
                            Fq(
                                1080482413989080742989095827133355882145916644050107904947286241343680015532831372079731428335852279346033971679564
                            ),
                            Fq(
                                3092728629816125767353864365057126507001205979289266899990868679978368256054525744913869592707471093750053411384269
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2.zero(),
                        Fq2(
                            Fq(
                                816855516913848362087601312470913702782665202544504558343217284988701825701207095180216058002758191175577529053924
                            ),
                            Fq(
                                2336353783117004615087541495693318079553421997796846762172338744692060058679958461055626947318692560853857669875588
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1612373658045170446416309522837125663814176700226931163891967243248610044916431579558836373191578141318076956694
                            ),
                            Fq(
                                2072248433536706020612710521736029638541070889583705978713853481259335162447354533137990959641834789868735742493719
                            ),
                        ),
                        Fq2(
                            Fq(
                                1167258912725734730384604160808666430162508047288600978499312346106761676360038775758230361453479682624906121649266
                            ),
                            Fq(
                                2656045334553593069794480040854718178321602488862603068281030553871160703637577667875594563767832231422729874944253
                            ),
                        ),
                    ),
                ),
                "y": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2739308205550812624471524333001122556615759201996089733030639361204326727614992792247116723263443390861603599293580
                            ),
                            Fq(
                                128798796383668921130597379617920031052671220679622083281726976062147277180771759645679229023328177667540159258361
                            ),
                        ),
                        Fq2(
                            Fq(
                                2855748519198725419512848138325811060529434869815720704950081629111666486514751086123202920820142468426087807743361
                            ),
                            Fq(
                                872060764879095646752473147709675890568886802311178119751098549638778055045707273861440186932491429012397456753970
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                83714790466943201684140203372636620607073609437412425714049686438679203057362133102646874867020400014856021508694
                            ),
                            Fq(
                                3454061757616964431055263042798013275045740070961498119107645101013203362634757017296865101832680677425606692749016
                            ),
                        ),
                        Fq2(
                            Fq(
                                2893732495213890555054588742634283907719643306876123854952660494436833099077844701674785521456547139987029813430398
                            ),
                            Fq(
                                947193312931337524377138258122941855227219352439942465334398920896307190925272568371017625689020272904538261622781
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1380630644871955468807598321138012441535196589084499157861207129471220979852059459981355013808814624984612561856660
                            ),
                            Fq(
                                3729785865490310409467185638586430123107124527559475419024531684227691914319001481899431456647722491153887936949092
                            ),
                        ),
                        Fq2(
                            Fq(
                                3342046399076159512515255971706926702790265678194166053667739928409554787635188960686499792771521698313011953339814
                            ),
                            Fq(
                                3002279538136018584033818233820854486977002429039272307219533779363817896732443416573968762429910532183521946997421
                            ),
                        ),
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3054493258926192905979734590903185049254921884698004460295304329495506547323133630866371109103137336248525010460929
                            ),
                            Fq(
                                3404448059561225796551055346736181185524602312173720798284547116331945285522293048381291314579098134664638853823010
                            ),
                        ),
                        Fq2(
                            Fq(
                                2462560817728792889967303441006325297981244490391911527154483082732609358025362891424403100140989451128719017741473
                            ),
                            Fq(
                                100393850682167187428249637160624091276288193852972334936858064829719547413324547187146087071586436970727472366976
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                437571620999934851341865629912875938344035750857974150970372400095533398791952359273161253755421283087822910279208
                            ),
                            Fq(
                                2542983771370070182368872637135237717233142986203157717840403105406732259578196904148181337732016653463789371150463
                            ),
                        ),
                        Fq2(
                            Fq(
                                625806239615019478733365127064707535859857119021243184443254234465620206065109396882557247777094384583190066796225
                            ),
                            Fq(
                                650995221581701466903952874946587201494773795350954954081492129528483095397553147899168474969777286783413920841378
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1150767825358566199036620997206164281966070689275955246852223712386103193532718530270465345122024892602416915614760
                            ),
                            Fq(
                                3580519950861112281835625348491255367059902471174394046562224160549027288275613518089182358571209917315034044469987
                            ),
                        ),
                        Fq2(
                            Fq(
                                2113941525038630195738292884495961709997953497896957721691433655257623317383266538835174597374630423671319545387416
                            ),
                            Fq(
                                2606984206966535892854955474611749167821699779299452141112107335372644903134578966803906043717039202182507945508901
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_miller_output_times_eval": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2676301817059161725657977808691518863463115535990436448084203712011711444314141297494355229633504891488590892610110
                            ),
                            Fq(
                                1392700349231684362059239417012795513809649595741718898828924267776279360904986421432908058539586018880545251219302
                            ),
                        ),
                        Fq2(
                            Fq(
                                3304608968797083239814522310807378065872001933607719358004124683308875612913706859207233350737289427643310767616036
                            ),
                            Fq(
                                2811140526572101635135086256312182529527836602309406624208627653746383973220162916198117475976156910978956930385224
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1117568723927364001788842728500093063688164747317510283937788153332667491117268040593856015287567204555359988199831
                            ),
                            Fq(
                                1042132842900619312178578745509812766381449590450616508166938396520811839019559109476979240923193114995861144524694
                            ),
                        ),
                        Fq2(
                            Fq(
                                3944985577116266930752114695749853961309205049093146028792517328241174692590408931153918526224619215329389398175250
                            ),
                            Fq(
                                3711682922995237348049739365846508155704204785356623234791293073353892829456448171980098083271470675612110286022730
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                2915498592068127765942886029622510738667810832803350363444614306861863187981585335321898276703859218555157907109036
                            ),
                            Fq(
                                2123121663319815785292910821124268448605897341307378393211811520345460965018130706475332093311889709155910837020740
                            ),
                        ),
                        Fq2(
                            Fq(
                                2176685397015807675093183978522281055313657563643426503520737868560282252411410708118057375020838190787573221405692
                            ),
                            Fq(
                                3425825011564047873528873743425610363809761006605744335603139068446141975689217140434122741662356332396354653005355
                            ),
                        ),
                    ),
                ),
                "y": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2942046249509571886842916308544904470468091778713007351348351765564717913840713783712070717366436552580723255186561
                            ),
                            Fq(
                                1363444150078561415021630025412193646199807706227782481365268661457179747335296414770929135330121776674105892898823
                            ),
                        ),
                        Fq2(
                            Fq(
                                612962716849924125975062337827099598703615486043256404132419282586938533978694484513912487405866908811249190760771
                            ),
                            Fq(0),
                        ),
                    ),
                    Fq4.zero(),
                    Fq4(
                        Fq2(
                            Fq(
                                2794628010888307085294266661760629638035658888157181284308380976048318155987449982843916332132912806471783985492992
                            ),
                            Fq(
                                1800739800904503866054197374207894922617402075810731570615152300421373903815947096957183173563899361341650790265904
                            ),
                        ),
                        Fq2.zero(),
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2285024300791318886487466738944160351729581333445749583112828449732449850725607274030360868734425375786156066629154
                            ),
                            Fq(
                                3572007815393458024676085156797672815700258305437004050932269221664097026674886839842850598698883341345569924871913
                            ),
                        ),
                        Fq2(
                            Fq(
                                589477176060049181759584788010853107286594809932285622960989373838915573143384217069381487578292845160874350488850
                            ),
                            Fq(
                                2099998248974824077691916553407396811265827444085208167995185315256344651059841970762644682704450013768851111375670
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                3318107289472039765604712729313546968673354750098505772633476320179297016247478855472213901008875986627545380356756
                            ),
                            Fq(
                                1962735734315697814376342639666449090806437392045261530339972878932014609121595738334982467569801283692412111208730
                            ),
                        ),
                        Fq2(
                            Fq(
                                1412306755682591706767306140419157394911972417916404445815205603925002574307122473703966087374868316132482474538202
                            ),
                            Fq(
                                2919229330261843481458617766123850617658921787529440224755557168349279695727907665781382204434622010782222800402
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                3677227022795741557845462727073811230225056894965848068747971000271131980590302205496059678206304783377177562929231
                            ),
                            Fq(
                                3470644924844873078652076339493083805807423877769832394421577526082713608530285376298990420781486881986039031789580
                            ),
                        ),
                        Fq2(
                            Fq(
                                1074720358715967289610733575440026670682731290933329592155700955833561344544072510879535945209172931093035810238160
                            ),
                            Fq(
                                783070269187934807677199582438336978505765628337855093332009543402178436496450629459892758346561723258565133773501
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_line_eval_times_eval_times_miller_output": [
            {
                "x": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                3563602369178665829509740728966408357508983912359735872288051298303710107521748866118866784138535265873327197516939
                            ),
                            Fq(
                                2122945789888691787227867411349743555635986878376209677080619610277351513678831695363775639769824080315059794338187
                            ),
                        ),
                        Fq2(
                            Fq(
                                3350888845026569803548122456369576695436023290629518055775564620590410197387353762636863542265917234405998438429402
                            ),
                            Fq(
                                3241080122010663172459044119259081517197943938128475420054270441017229651347666300613726640858418599367812640534165
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2.zero(),
                        Fq2(
                            Fq(
                                442648690378806141707217015500076242544246379790976399373540825903102574259981775268856263735936718301297169596460
                            ),
                            Fq(
                                1559356009594886108123823581419825825351782837543138902875143707100664596461180193327022173959422868375851560841040
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                3078413575025480944707948557951598508216723547319497068349871310486619883971821149743991835137781757200931813555325
                            ),
                            Fq(
                                1913449955708599806177162830580563976586696434015693751909521718938066716198340650279549768642469267232422118652590
                            ),
                        ),
                        Fq2(
                            Fq(
                                3650453407427822533849605810167639842577796830724649458281943768718387656389141855809019160744758922447965493465997
                            ),
                            Fq(
                                3179694195648279713022208982946117533505018791435232551975899779635852968019975571749491106771268807482292711420256
                            ),
                        ),
                    ),
                ),
                "y": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2689224737383233272342468965267665591094820322066150138897105769203011024812642891239448998709270483901521484201188
                            ),
                            Fq(
                                329921039116247259821150319179904424517946376753128217704100090239346822561627455307559409640978856522085476947219
                            ),
                        ),
                        Fq2(
                            Fq(
                                2595173290526874564336001066191537428492257477827649886588018682161277326126770617795785017262187805203237176661485
                            ),
                            Fq(
                                2483023172368295434170363648069047413015750518179841557172938283848766029940015309992487266484186721253227597169963
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                2486305359507039093145182438405350459218409399708692631772384029344086388227149972881353901670443426133380198703629
                            ),
                            Fq(
                                1951018322428489679289806529049345404287885533250295825300799930729868872979061860172877735176311562449496369931401
                            ),
                        ),
                        Fq2(
                            Fq(
                                2525023763543175051881337551901776008261323740757507194077673793704118308157074199966334846627503750609042446184780
                            ),
                            Fq(
                                874486435787540477184101414459288247958038470620900031912379321726689396439353869481970256987689523152426449003228
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                571746062610230705845860031457908122721939389310049814175224466271076141908081779760948596281522357791967406528460
                            ),
                            Fq(
                                2894460112077471678338093870835164690598850199329714215989281536669726412067117287381286502021695352433221514927809
                            ),
                        ),
                        Fq2(
                            Fq(
                                1352747945110516417481719815195814458980109070155980815412605877803300844275309016201327185862852453562684377549646
                            ),
                            Fq(
                                395268490899085886661509039228299299695483414241146102262539017136555842826354109084759823227378509906359971239032
                            ),
                        ),
                    ),
                ),
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                2597330769371931604106703429484577153199343960545399306446946348596084756497133275774720343827808936422327670463193
                            ),
                            Fq(
                                81217383364196845572111447556957915090427636855247134841053317793241797054635598247991457715552998429436209033940
                            ),
                        ),
                        Fq2(
                            Fq(
                                1257832975121864462726660899724365906363296829989049415160117080182859595279821480300223284449736043522118174995122
                            ),
                            Fq(
                                3908314317118613551739183082233359254867530945311650759976699527726028442364689189557389588214624455015596505363958
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1024788865202056085872416732787319613897718251914640845842559340997784594014189145346838440444450807392928343225863
                            ),
                            Fq(
                                3774318146992736151842621680646094665959203827640795336381037737354400533874838832192120387677075056357302101446479
                            ),
                        ),
                        Fq2(
                            Fq(
                                3594475360644655071993063077326445782328857119170817108754692697502084750189389627619012073467498588912868345209784
                            ),
                            Fq(
                                2086617678251189954976687705281942973046057206254549944296243822165120112913570049604702688532501544131507223204208
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                2809741420976323803748198578338553511405046700184805293045327301888702327280809559839812055607304428178490707181928
                            ),
                            Fq(
                                1955518240887133178513737534971553834078994507697838352728141712508589187512743002485389622725358022651996964648189
                            ),
                        ),
                        Fq2(
                            Fq(
                                477498393183152079912769631602939922199891570327016742087147733611227660604651308027377477248133922376699731505461
                            ),
                            Fq(
                                3070924100818194765026464229233989102080812901879656456758029030508997167661357840089275253075972659922959034748339
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_easy_exponentiation_with_inverse_check": [
            {
                "f": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                1779843883455176577278129281176227357097889215082710606979581924870519078889468459429106401388411420453902484867968
                            ),
                            Fq(
                                1866034890696329343234306821969050053331489928721520470910106472104401444268578030084145836186200334642325973445522
                            ),
                        ),
                        Fq2(
                            Fq(
                                918277210310792788415244862441503909923531288365572886616757302548082219172745734991087728109666302342386396458315
                            ),
                            Fq(
                                3219692734700695408558583960778972899670915457640386921951262817900366876386389503100284719287375638777084033049687
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                75222571939050669359409460300658820492302260297641900438930754230662748061525072575812650856488123713324027778624
                            ),
                            Fq(
                                2470432209820034807553941105297967733611276034797382754833140436048744310501123043434651440357451447983738664700953
                            ),
                        ),
                        Fq2(
                            Fq(
                                2071171442154129995391931591006717770648588864875532551355940861427838599841379601495333790168120662742040772186106
                            ),
                            Fq(
                                1736690353287225057183606274688037966254667339401060290087405008046935549658004922787938173610485674573987484477259
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                2356062092506087016129937001477155332657598248578490018373824393145246355592056446288375441442182828986670920383689
                            ),
                            Fq(
                                2432393356478492350051362530477425236377955564357646144913949741294727038545022553404472780651353634095696968895146
                            ),
                        ),
                        Fq2(
                            Fq(
                                2177663433276943818608989951538565275116003687073623087869615914192924571070939455831750434232331942487469646191822
                            ),
                            Fq(
                                3054634223462253675410758876217021590486476781052834766132421649611182926735345348645661377853911214548190688038567
                            ),
                        ),
                    ),
                ),
                "f_inverse": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                1034036596940419317493463213700292677665347157367066729130891714293990922008794804468865581730266306813479896264613
                            ),
                            Fq(
                                228624813830274463654077496626653739420034889007576977877726948062822221810617426082613353105456640848625665879308
                            ),
                        ),
                        Fq2(
                            Fq(
                                303546873713233393067283239384451356204514058118349861665379697752485180130806645652570842494927397576254742169984
                            ),
                            Fq(
                                779713009275873746414767962150759211137273117649513215468588944960237469821513936149909854341574614052580190903395
                            ),
                        ),
                        Fq2(
                            Fq(
                                2380058201354839594161437204145277182591874152598412386171495217269527762749792398238392417374164455907952588125801
                            ),
                            Fq(
                                444385481902635875997910637711945662898273903107489582083893918635089250095470148459983692460158064171158803347048
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                1272952309174804405591334090946469618425036282336229681380828095898698501968186296748221339182344529896399821151712
                            ),
                            Fq(
                                1630750840360865649435219038671578983860548740046987097724295168568428819011573353680282860316736656395881090405067
                            ),
                        ),
                        Fq2(
                            Fq(
                                3973577772829260398335251256104258901442189879340728199458178926337428143091125924569735981011485439539895754978013
                            ),
                            Fq(
                                548028082588134860962252647304352285724650864124116933324831840444872573723491129555552775950488441476363956212914
                            ),
                        ),
                        Fq2(
                            Fq(
                                3020009528148089111631599510171862625527281432906953950301811538293477428173250718928872802422089636922863096851524
                            ),
                            Fq(
                                705969043105439874031850563096861946850198448295304563127029696716581558283681671836191201078994805389342822992602
                            ),
                        ),
                    ),
                ),
                "expected": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                3829018423854513112325754226557967253152770574184571892138638942536839947274981001092534790095041870392358884543501
                            ),
                            Fq(
                                1951339461136686315916237765156801408747047492243174779327161869019282708329588963224780073679018549456011061612096
                            ),
                        ),
                        Fq2(
                            Fq(
                                3477544744469890913958760306328697666636609857029430769670097547048167183270554741616132157757754091399344156426292
                            ),
                            Fq(
                                286179704750095907195536839968500592096248811345201513692924841804027182688137808521013738808221855892613472809308
                            ),
                        ),
                        Fq2(
                            Fq(
                                1132131233760177823045781692342637504319741511186217429640247186654563695621839777043341666276745443341875573963160
                            ),
                            Fq(
                                2076016568735166501163275123531151315767243884863733920279617796893732894458295819969307827535156553674138155097980
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                2673691560971433892904854866283842116041676863406654640088236032725232414131977724888054788645099400666589537396546
                            ),
                            Fq(
                                230829030628375573438548623203565147832716122001421883736219183655345190762284123422862248512062085308532084101081
                            ),
                        ),
                        Fq2(
                            Fq(
                                631300697461847496766243394955354273100600574608015356072740213126747705257243792759074479791143553046065422120767
                            ),
                            Fq(
                                2050336775145881221495453900038142246392064457594933314775494453759339031956223186388674235315902071336691249596480
                            ),
                        ),
                        Fq2(
                            Fq(
                                2065958979766407259374641638318928532012113910117406053125587139258171350153699686321622288089600826720016820063741
                            ),
                            Fq(
                                822739237060398018918674936940926538809795915273841629873513158452115043850480152238136163525457674942085158166553
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_hard_exponentiation": [
            {
                "f": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                2346938073710250597215129448135319768030955831631036091917381721011441605329148386305775177428620138442380020446348
                            ),
                            Fq(
                                1289751830592817767498509773936054323039521660800091940633187323627548110081837705272233385295580662476378723544049
                            ),
                        ),
                        Fq2(
                            Fq(
                                3389410244399974171162160084753972305214209664847925167874000101338022071254158451502897437091160109070430544640438
                            ),
                            Fq(
                                3807401851574621550906304726508249821352569660299467308708278074024468269186303640080359366417841037695662017493817
                            ),
                        ),
                        Fq2(
                            Fq(
                                3106049007963088477141659444998635732102191528643299250198172502086729638997905488964378471332087327559120006609968
                            ),
                            Fq(
                                943091985468508880264828868006128582247818185896188260418091117434050891058029293579014252326053158021397854843990
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                2368566103472575499922273706002055966284981307687882785679280745335974152654516603415001732444665076940120119545253
                            ),
                            Fq(
                                2312123306448066421601458965503871112978663403037183540012387856716895852391251757113908328187824630185333501587562
                            ),
                        ),
                        Fq2(
                            Fq(
                                1617536387112952640263500135158654180480383471363348805784172085864553054558427768567764668348888984368414706814709
                            ),
                            Fq(
                                1761323438503831930973574585658420011433845829382637061131052865223051204021442679514185722826185648218544187380723
                            ),
                        ),
                        Fq2(
                            Fq(
                                1052941394727798309192951701081721929334327135901585732487741853050726852497116015687472585756827650359984808735313
                            ),
                            Fq(
                                1566269216510578769073257912017638699685666950740897517838272607921501518223134049480772834502515537195645748735766
                            ),
                        ),
                    ),
                ),
                "expected": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                1984747397866357356323509560082818832221041478998840056990048117405412647535838459188912656486051535914703671078944
                            ),
                            Fq(
                                2643974183983186055843569885657903514954817259866830646480495833655347885187160522357024646928715227350816843018271
                            ),
                        ),
                        Fq2(
                            Fq(
                                3811185077412557946106562765752982010449811699865577767849045361623440583671505058539447956417345881825477558119299
                            ),
                            Fq(
                                1700909977957797041227787806942620386078958083415187531993665778763363379481252275686295576473688874431723281338698
                            ),
                        ),
                        Fq2(
                            Fq(
                                1716178700977966193563958192656463426565978710204222171766150525912660756854340941332431944382161326908605318826343
                            ),
                            Fq(
                                77852927619276289664209338788062535070050252848209001510981897604761595472555608349990788279656399807672091419719
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                2796926233775638336777286912019105537469080335131965091021587412812423450119334593256570030016395399940999712186676
                            ),
                            Fq(
                                3398204868897291947669322107364006203499072325471235178209038565541961073036229369356457562463698926027036904020203
                            ),
                        ),
                        Fq2(
                            Fq(
                                3799383576862518507206789027453869124826545796498130325858338622349234716266919460603309181800051338793368818686006
                            ),
                            Fq(
                                3213471702990896338682801794253058566109084343717772025159558881129035750069530419457830251470467776932204006527136
                            ),
                        ),
                        Fq2(
                            Fq(
                                590446621881366413136279546520270410878845330796408278327975273595127045497172128505048755424545220534752012326112
                            ),
                            Fq(
                                1795472846065344852147296070924244459286481264189491617387906155135259385026361547504134913681621959160003318241573
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_miller_loop": [
            {
                "point_p": g1_curve(
                    Fq(
                        1608121574170059884560402737041075551004398222753167322502737202442103657878527703861294588816957778723978358656929
                    ),
                    Fq(
                        2810743485049336686417731894326329677056358807341535683342934635322400997285682160742505930207760679245881967665294
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            3999096753806221938193196087566193520864855872588351781649866794914682840111282566711297983929539126493851563635185
                        ),
                        Fq(
                            2277113106055201253815795966017788660580019758185094882868200539277759298035222222194387889225563218210817023490658
                        ),
                    ),
                    Fq2(
                        Fq(
                            2268998761414299011545361461155201681862132196216056430775427559859343401659581550865442172737566673718687768195332
                        ),
                        Fq(
                            1018837896762007719923509068193911136338709016378853682682039641062227079372756834301015465469038233127532368863687
                        ),
                    ),
                    infinity=False,
                ),
                "q_times_val_miller_loop": g2_curve(
                    Fq2(
                        Fq(
                            3278068326596990632802692875238327676419245951176508994282249301324515766694836317858631109550066664975403596849828
                        ),
                        Fq(
                            2125801573092337265857818467796936916403008602247610006982944095004506827941347714688205618972991840153926899037020
                        ),
                    ),
                    Fq2(
                        Fq(
                            979487067237756839753469724437610663983095165133648300338645421624236634805238443593147088503048134403539995903455
                        ),
                        Fq(
                            2164843602632328484355700145610605381311287609028561391135139260699669068458416902888895566749347837667947884153398
                        ),
                    ),
                    infinity=False,
                ),
                # Value of the Miller output, Miller loop computed on the twisted curve,
                # with quadratic denominator elimination, and F_q^12 as Fq12Cubic
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                1053449815732707056224332018194837620890037444934902510957667361979282596691579009245967330272821251264173283938230
                            ),
                            Fq(
                                190954644757482649648288740015033698108916735948644517485489040983651090115483248526813161336128606764736026610078
                            ),
                        ),
                        Fq2(
                            Fq(
                                3821973078997042866023214831741831707197877714238198833105438299627407391668039908761322333120412224176392729068054
                            ),
                            Fq(
                                2828341397434274487264550564601821226651489451947629057798980879896055823013467626382272285532494811110372947967745
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1733324072812011893744421014238955392070027118862788002355906501808770829736926569093717868872257924255592459238963
                            ),
                            Fq(
                                3247682180314234962227948133413545946402904941936786435910234152818316785810345601623587644281163391634093847563921
                            ),
                        ),
                        Fq2(
                            Fq(
                                601995745186632440920959477033157073887629749627190968831105211797467509197513237921069132281754426933413271971146
                            ),
                            Fq(
                                2021035614834589360077110293562083920951983052001072433626463420357625017047301780548993696300340057548049287073660
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1944323251685370780086353393275250372506996116709755520603046429030206497024586801473648907623666244434321733912231
                            ),
                            Fq(
                                1449150420228409407774108000664317956789884420165509794160498933940000399225111781728530024388483314758946991287265
                            ),
                        ),
                        Fq2(
                            Fq(
                                2625802267684211024891326094959061116110440484781791101758740991573053638450872744796930567238924350707572439742946
                            ),
                            Fq(
                                3139708573359691517100061544389849589320383328086019533256568286715061320166136389026613498257130274902799155322954
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_single_pairing": [
            {
                "point_p": g1_curve(
                    Fq(
                        2164496310371602158625401652846445265711783933226748576971724475197497431624640485146214135103354961221545860757666
                    ),
                    Fq(
                        3927721937187905147565673896457083842511788209223509741818571379715263914736501507254062765725070325879003018239389
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            3763763975204108445729736824603095119096163551087943235362871015145032022528910304754394655997505423714351305526852
                        ),
                        Fq(
                            219441997532584872500414644453545107165194554073119296031991811666005685779233138450510195689261557813207470706471
                        ),
                    ),
                    Fq2(
                        Fq(
                            2919263088846962213789375134040198354675681326531042246704573211994898209824229221640698526545834837257920588007171
                        ),
                        Fq(
                            519773686687149674789995498254238327846060634631179218516093688300270969202487671786529325112637895372806618173220
                        ),
                    ),
                    infinity=False,
                ),
                "miller_loop_inverse": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                3286188796406705964252287563545932693001464313050814565918970797300416438264629817493767889429288064177269638853239
                            ),
                            Fq(
                                493472346278755319173361419095477799366411383879049917370083288954375765749079203259871124149641815009239825778766
                            ),
                        ),
                        Fq2(
                            Fq(
                                778600635369409280132955901786609858622659092917765383934512284824827583589925424627953489889112956281443429193495
                            ),
                            Fq(
                                3530255081794037192563093093027338566614088502364204267964164607815648432508166941360369378670279007418223126522260
                            ),
                        ),
                        Fq2(
                            Fq(
                                1034808900447147435355393545342801661583283615038168422750668719001720790511774518222374665957285909379679570825283
                            ),
                            Fq(
                                3584471331715119442622480087187393256808910459405261658612687338324914397380866716175298718167139539945365920876250
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                1059609147079404357736279075183359660492532100140618940874461792197350816572454318411201520444654184255051725435981
                            ),
                            Fq(
                                158857958833041154849951486085250306747700179081881519795820353344025569875059262597448792021120303554364107669079
                            ),
                        ),
                        Fq2(
                            Fq(
                                861234248728170527621483542114933016543696064392633311727185459314532439777226430851246481825928128361349480616881
                            ),
                            Fq(
                                776766429846622859983688284041290485657558811749961632201255968356580503742933462577062231179682443818231389232823
                            ),
                        ),
                        Fq2(
                            Fq(
                                3821835346135750764932526535702893843796201562213010050239160545090940663021874996404503663405140937723400663737211
                            ),
                            Fq(
                                3168323499731893992373098480420334159342001912147195395595322099010811525232962139764927477719824345408626094466925
                            ),
                        ),
                    ),
                ).to_list(),
                "expected": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                3758515893037467724272696913884764491441698997351819223425746226399443235935356963301852226669666465293665458718558
                            ),
                            Fq(
                                3121621638557945401106095685195939775336627336515748088732075205924475365680793879525106193461551844320844745531479
                            ),
                        ),
                        Fq2(
                            Fq(
                                478047906491068746244087993763131531134537711625644182370391975588723995735530882617835767469589785221241912049140
                            ),
                            Fq(
                                1326734138839515667726845249627870737045558888894605164211031471966829615772702097585664182850845675524287878341740
                            ),
                        ),
                        Fq2(
                            Fq(
                                3325993578108375799087108252496933109337487272992027626002417310539383007711103092043900733598193825723535151423452
                            ),
                            Fq(
                                1501507775326957765879438376704819332725758187936244965460375506607624285246531250552426883386616463076420890949885
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                3831575903743084841378653522930766706922562772710783530687740668611245202249164759273247321688660344081277509586892
                            ),
                            Fq(
                                2901802208068848347552335102430019790602402410168172637879046972534074348415983690718979159907719554629492519387019
                            ),
                        ),
                        Fq2(
                            Fq(
                                3237807091159452556149137322210455249550230203389332918110494375400248118399987737578828840222765283325149745024320
                            ),
                            Fq(
                                1282132771064928599731446024367975455159285966517424620606072073599266442211324713891143026265868495047121179115367
                            ),
                        ),
                        Fq2(
                            Fq(
                                755610692939787970592690206844450364350155382723698398625921597584548957881249124311960324701029630415664859323827
                            ),
                            Fq(
                                2573404142794793664631613979914638574324856910817579558951757685347629487121779854282828154084355545859601075768544
                            ),
                        ),
                    ),
                ),
            },
            {
                "point_p": g1_curve.infinity(),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            2527811126274150782362462984750514459178261288655408519510794143924196154457421800765888325088734040767889231749242
                        ),
                        Fq(
                            3197866992968182293584855396850506160779808600914285217046164976109932215730087738206020003207948771298625074986487
                        ),
                    ),
                    Fq2(
                        Fq(
                            1714524161616022666287853043009181672523752121051724844074777115028213527157088454886426043201320029762484366796939
                        ),
                        Fq(
                            2379899501513509879206813384302896336087113796346967210363667879657228467723555305980677256959326558040020250172773
                        ),
                    ),
                    infinity=False,
                ),
                "miller_loop_inverse": None,
                "expected": Fq12.identity(),
            },
            {
                "point_p": g1_curve(
                    Fq(
                        447642131847111984779201362834081984682825107737641010263791904993627363530382117138797082213925519020717443251444
                    ),
                    Fq(
                        3940316366197247449915798820633663783212539452369146855467651050299861267878828710144514659637219550683883930274961
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve.infinity(),
                "miller_loop_inverse": None,
                "expected": Fq12.identity(),
            },
            {
                "point_p": g1_curve.infinity(),
                "point_q": g2_curve.infinity(),
                "miller_loop_inverse": None,
                "expected": Fq12.identity(),
            },
        ],
        "test_triple_miller_loop": [
            {
                "point_p": [
                    g1_curve(
                        Fq(
                            2815169836410873834393647983886540743261242459561173383255288239730811076352757838419407199427171381211763391756183
                        ),
                        Fq(
                            3456277654081115151058210584394571125988183390927148104587989713674461218685419981772880940563551295924231793030106
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            2542917790061659618168311729296608243429339497819437264834814625438157790624683797064879027799670712158905473441835
                        ),
                        Fq(
                            3568325865723841478811427286225601336257914642399629715091642376835519054910285011518557579445267394761818813997847
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            1356566271423358805285433740534589153641769852270569994889540223468412527856018521513904317402657903521695627730172
                        ),
                        Fq(
                            2906254126860993804911863403788755444891605512328024720241678037135442121443952697269567343991007241680651671389172
                        ),
                        infinity=False,
                    ),
                ],
                "point_q": [
                    g2_curve(
                        Fq2(
                            Fq(
                                773359958589040965839990181311603098989032555694990576660147970679077531439094006881293925065361285403573253566971
                            ),
                            Fq(
                                2826838060510091765564955304331653226177359475175921229100265840052268291198634543941556018620965396432838960074712
                            ),
                        ),
                        Fq2(
                            Fq(
                                440221825415589708935863725168190709897374762754293865780862569519219647061085854492051228799102584338016198839813
                            ),
                            Fq(
                                3235133928793620371094877746158293143711402832902266297844231656698780876966243324859860609953952654158507707717148
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                1052382294607998339537979989815453958764076538199719914786316691008546404287660347393719061095132468573924305989866
                            ),
                            Fq(
                                2956077214400607762828860741856453590874381638209541417192934221921530075873441294432590614911256207672809731889368
                            ),
                        ),
                        Fq2(
                            Fq(
                                305749401878005109189865870467658699335884895459565572108749553788412091320752538328197147834654831836396359430840
                            ),
                            Fq(
                                1079645439058880390573485742497984529621253544699781155506856313916640290209475381414708443848039322812855273892409
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                3432757947869754477460039625508879605761135239046792994801097649129823423968500226985370429901184235146202748933919
                            ),
                            Fq(
                                3467487515590566499637856240465862712179372381137898346359780995781977130275329901403230628178489740168616599762074
                            ),
                        ),
                        Fq2(
                            Fq(
                                2902830374742147283895811754230862231334504116145872818296651546624950850940544484880464702345516491020026251592521
                            ),
                            Fq(
                                108981147252544847533341879301161883931795190435538585053451292791939190818017325775177689135324833949958216102016
                            ),
                        ),
                        infinity=False,
                    ),
                ],
                # Output of the triple Miller loop, computed on the twisted curve,
                # with quadratic denominator elimination, F_q^12 represented as Fq12Cubic
                "expected": Fq12Cubic(
                    Fq4(
                        Fq2(
                            Fq(
                                1760655964470870499882099043474149645237539852366775743990239975193323556814825234177233644139813985428040879899214
                            ),
                            Fq(
                                3004841927329908145165271688806746629395418305810158737377072441900295411635669677353491293145771054701820371149151
                            ),
                        ),
                        Fq2(
                            Fq(
                                1469376258643817405446549737992314523079724060980552357295197060359939993414295829067339178829511908689110358129138
                            ),
                            Fq(
                                3339914875248431531196486142300583042169736722825661854642555793058147342319030163336785044381006335122436958671397
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1458969843631401400798557727630544096699422359557807946578638801015098639946558102823754870314567952460868041163215
                            ),
                            Fq(
                                212272747467661723439639020953573701140339608366500643209280269446998339233755044390823498312106417258491281267736
                            ),
                        ),
                        Fq2(
                            Fq(
                                3394007034151638660977030823630460271797803112419406086500684996532035288167563221743733093481492412652509944350887
                            ),
                            Fq(
                                1512448527628866854955618960183690872313766958495082583966787391296449357737831897829400351911207804568009560579775
                            ),
                        ),
                    ),
                    Fq4(
                        Fq2(
                            Fq(
                                1000792581691518764784402356301419887669258920825145461902236817809229338056375389367760390196050840969285427540666
                            ),
                            Fq(
                                1516751294351586840212601578152102493372755153161831759294099987462429977745724694795257688584955488808816584121640
                            ),
                        ),
                        Fq2(
                            Fq(
                                3588122536267762546586627041772864862502320724804169811204575832803078901387588886550220354208868682048809083790662
                            ),
                            Fq(
                                1085948164656331858404772030619322975572209671891001462210539660926522140816043953270141539346013850163122066516920
                            ),
                        ),
                    ),
                ),
            }
        ],
        "test_triple_pairing": [
            {
                "point_p": [
                    g1_curve(
                        Fq(
                            3069926138539609894601338878290447162313141961991193193769116799774596342420674030565061534888390494922191509923097
                        ),
                        Fq(
                            451175313921367356115595127801209363183746174942879529513088556013161264927509078725653834792120821260098067206673
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            3611529847499770697345184671853490042396934279550277391619800374477180915011035405889936544821193793125169745922916
                        ),
                        Fq(
                            2167249799385908440824821265874906398032032822901533152612873652761128038546298343757776113742078257324534870807992
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            1245929541380058524104333232860014668017760023923869189413957620151502026222199792167330240689213585517255386631359
                        ),
                        Fq(
                            3684680579129546012934575163110128538463719282504648659017351390083586057248198308347231716373889367668019234925876
                        ),
                        infinity=False,
                    ),
                ],
                "point_q": [
                    g2_curve(
                        Fq2(
                            Fq(
                                3142405812254489664740383423202759185039986435711277531848972412417669732720014451544755523734241001731566169155327
                            ),
                            Fq(
                                501112183618995506070219533518319074676873251390796667662495138325345156525190552731761197342765112366186479031364
                            ),
                        ),
                        Fq2(
                            Fq(
                                2036470696071621640003696145847255166633845041791352305143146139914774092209237085434141225325413204168736317687834
                            ),
                            Fq(
                                661440795131018033583903266275380929156003622277089052242970513196493372322690253272584592063894254146785098935914
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                1002798011878061122273467949873107588134977001669334270174107245635794673490150405765529556687263142928838937589536
                            ),
                            Fq(
                                648605317217064595955849713078205191688603667841348716366257963647842697146651292928920260473234151185947472615616
                            ),
                        ),
                        Fq2(
                            Fq(
                                2304957970572380677387830269502399847298742902133534375643519576521346957879864054649072418046726956951759399955227
                            ),
                            Fq(
                                237832496314918829718111593557424227083644006152115330116770644600759704625098009539159069892231159287660345182439
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                2565037980652609686260228280612124683525724491221757542640016803915719505619536757558030317570465460239644060908810
                            ),
                            Fq(
                                2608982414337347983904270805977963953821971757370649873554809588171120206293388561025393150221991699136358905198183
                            ),
                        ),
                        Fq2(
                            Fq(
                                683367918222300724459405920761542222379258345624211114431779032259213318540491095384195916473363949804755017384903
                            ),
                            Fq(
                                1890274256446986839459939439421071697773983554551012471861981815106259559707322168376039174919197008855597831405169
                            ),
                        ),
                        infinity=False,
                    ),
                ],
                "miller_loop_inverse": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                477658122749262828858374600504626899223252401702967513843258019943836048302219997875844572358268343683328342601330
                            ),
                            Fq(
                                3295383598749316779329429152440785010446704841530802724009755014280440498912017998332057563916883198751205783463482
                            ),
                        ),
                        Fq2(
                            Fq(
                                642637833706841331608236902714345021670368118372009777777769297755709439998279390557894267582221709468274396673791
                            ),
                            Fq(
                                3344875518695344701680490528795626639329593213551244593622485309432545156147901562843908677677797003897589444973404
                            ),
                        ),
                        Fq2(
                            Fq(
                                2108372663141451506887869237860490767309943247996127422128357658839742933300841194417454177463312510183275783362480
                            ),
                            Fq(
                                3797618679118738890064204359475788674664469573672523065080787509008646415851317926729467298872603165134633249640725
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                1751474991883530856540265964584316339295520996825520231604345837731269173879194631250413457015255879582656426248042
                            ),
                            Fq(
                                3546749673870633106817346553952499222738671877459263145483203456222474838642776260205967633474156291125589900505900
                            ),
                        ),
                        Fq2(
                            Fq(
                                187213519303636147232937052902582472477402134431059740960381600042570765371663723255729652390259159532471302022720
                            ),
                            Fq(
                                3152913184589096525750077455909900415745329835086918322865167343668329654043397652025056050431508984359763143294513
                            ),
                        ),
                        Fq2(
                            Fq(
                                2589406979437734498960978943661528772543718709947521729282915764985379037984945513361024384611314145405216944134561
                            ),
                            Fq(
                                3268902584042954775101334100913743525356665513804289815147730218626506020684650369202034393268912174252749123723494
                            ),
                        ),
                    ),
                ),
                "expected": Fq12(
                    Fq6(
                        Fq2(
                            Fq(
                                2534028656017194128087654793721691461575843102430860268597948049346299836342248527261167959173954413751558126808257
                            ),
                            Fq(
                                2337347987200788067588679813725499119343570726034742693231372481730206134693933557136236320891220968022223504355025
                            ),
                        ),
                        Fq2(
                            Fq(
                                3591343701563514784722489567071956218749088644224686836914631090140545252097303681833905444943424195946059158011081
                            ),
                            Fq(
                                1858064938749689679379193397593319329549544317604586974869990616648428199033122176062498645732724696282405707706894
                            ),
                        ),
                        Fq2(
                            Fq(
                                889348256295201224848957220650845280399338276397116529534431886602918207235219631880336132252406965302844448295998
                            ),
                            Fq(
                                1191542448411791003861213077012179482965733299893987858257184856950063521865736424680511469218722878013162712985981
                            ),
                        ),
                    ),
                    Fq6(
                        Fq2(
                            Fq(
                                1006968903945268205653738684228364968304775368361148858035114976991174059788481037979155936922821203563062925742134
                            ),
                            Fq(
                                3984489564158232558975808213608145001828334324731514778226395744541208096021243891540097604042939158055526724805011
                            ),
                        ),
                        Fq2(
                            Fq(
                                3695490854115509554265330181244631246632520602032149933608228262632657368419300121951791120263224709010437331471836
                            ),
                            Fq(
                                3209437658641154150083346723296968997375100513930244902898720321820093778914801321513997359033011533536124648675010
                            ),
                        ),
                        Fq2(
                            Fq(
                                2003217444353019689660260295510418368268831929777741842506164036451312561908691683962624977959900737724583642390228
                            ),
                            Fq(
                                2936248091395372637587873350686221787156548280336858042522565701064709609238007879662782816897891754175273034587749
                            ),
                        ),
                    ),
                ),
            }
        ],
    }


@dataclass
class Mnt4753:
    # Define Fq, Fq2, Fq4
    q = q_mnt4_753
    Fq = Fq_mnt4_753
    Fq2 = Fq2_mnt4_753
    Fq4 = Fq4_mnt4_753
    # G1 & G2
    g1_curve = MNT4_753.g1_curve
    g2_curve = MNT4_753.g2_curve
    # Define scripts run in tests
    test_script_line_functions = line_functions_mnt4_753
    test_script_miller_output_ops = miller_output_ops_mnt4_753
    test_script_final_exponentiation = final_exponentiation_mnt4_753
    test_script_pairing = mnt4_753
    # Indices of elements to select from sparse multiplications/line evaluations
    ix_line_evaluation = [0, 1, 3]
    ix_line_eval_times_eval = list(range(4))
    ix_line_eval_times_eval_times_eval = list(range(4))
    ix_line_eval_times_eval_times_eval_times_eval = list(range(4))
    ix_miller_output = list(range(4))
    # Parameters of the curve
    exp_miller_loop = MNT4_753.miller_loop_engine.exp_miller_loop
    val_miller_loop = MNT4_753.miller_loop_engine.val_miller_loop
    # Define filename for saving scripts
    filename = "mnt4_753"

    test_data = {
        "test_line_evaluation": [
            # Test with P = Q
            {
                "point_p": g1_curve(
                    Fq(
                        2943035718946563140535551731622071688826012267601483840566950709511666595228171168049412040842235954965616062691438659424344558201030283043328707428862049811655722732333051298433458352893283783436482075686030385465227721307986
                    ),
                    Fq(
                        39336537994342322996720041784537833660034304793043306540198501420372397262266297945251257108452366038680756288023358680810924589318935432051466993568851643259826515923501024791551335429421880490161655838326616618947703808587617
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            30133687151016488388918849945112595293454764007531829368875882016583077287442318364462723332724211995550487385600684403925350109630561432397375105127771513461718027401807630948510760603980713063532116983547252956869600263221770
                        ),
                        Fq(
                            9504282385624990957917575184779754496132771000820366880675446853300554365951288125836448013089257304910565328406874250905166988121028565623613440617299321532722865804475503278336869206045236531660232155891295938146167124808799
                        ),
                    ),
                    Fq2(
                        Fq(
                            28197515782378083803988219778362235104383482126460393250280878557811096913452087543100069757007091091784773491507798079502299059194854293392514633844437561426829620517163418413967892712164760077609712623485652384941268224185246
                        ),
                        Fq(
                            28020752709766170161603494021496096817361686131413032883771488943716740267740919564118459337572095795926242616994754580144758191415708250942147803370578729782986597860078220093379499539763188447850918288220498379934966182704274
                        ),
                    ),
                    infinity=False,
                ),
                "lam": Fq2(
                    Fq(
                        40644598335632230899107699847870736302193755915550815170786174345327361730236259885050705376971604153715202363341700639725434107093796841157127141832286856130944837765908951909404662756062141401532899810784309635288199871197667
                    ),
                    Fq(
                        35506882926469172161438412513171837882329307713891300466486421536903522239386582072378176156789424134169054957977254215119238776637420740223335811329610548537868650861291712291786440018667042348507713081577760388082551570275202
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            9153391303928243189473536986210839095804974178372913021076199513630977256494960972384438974358309389761611139553928236088939045656107792267523717330236626680344787292266708448365069250593669943687407119461381132404598755720050
                        ),
                        Fq(
                            26600316248159899823580017518945360916946673808724830059772557063874630826696259034625101248201710776391848955903031993828380787640521803732526045481556808886451527603762953464331586429819828237496663595541643965074648500663117
                        ),
                    ),
                    Fq2(
                        Fq(0),
                        Fq(
                            39336537994342322996720041784537833660034304793043306540198501420372397262266297945251257108452366038680756288023358680810924589318935432051466993568851643259826515923501024791551335429421880490161655838326616618947703808587617
                        ),
                    ),
                ),
            },
            # Test with P != Q
            {
                "point_p": g1_curve(
                    Fq(
                        39701188837158839599332240338868415468539503903682774786272393554054412772628854275615038466530962152059895339807856882265262252799497914738553723100752376712717325399105793231350009684753599123813879147723058318479466800863432
                    ),
                    Fq(
                        21556070235872291123524869787302508656838950098043385938353245727085608109102983558653715230510029280356391574331861504129391448250761624102861879044555456636898345743619671670705181676229095433024425382825929497574256934181830
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            33627408316147770904620847441430878562001414859817408752061800521442963105928677545587897106276151445940055678335950415735181421514990254262450644544204278034983894996624601956688139677118495636594836372758751502911017571101134
                        ),
                        Fq(
                            40146083111620590452867969823022830572142503989750974896637436148815182249579321273755562792921266708965834389833748210001199563927966766256202851481012930278421111834200557825649862986672819741194930593328160261887807368935462
                        ),
                    ),
                    Fq2(
                        Fq(
                            2132212212460305338215603135074013156763570330425225515288046400173518662168792895360296722770745056326454054383147465138036142825185842699562946011317465519283392482013083439043125652544475073041886621982647266901078232866995
                        ),
                        Fq(
                            35197887172315080990950785042359790217174757094916314961335240484170925865914883259972300732472331773392193555460161164035744966001881271310101059583476141567462108086414429771746707401887538586792539481114917076523132773691452
                        ),
                    ),
                    infinity=False,
                ),
                "lam": Fq2(
                    Fq(
                        15305276972755209436017024450977423760414575584710850469219375353430117850435028105422503343261179352245262051434880347928716490315531959812840605589707846944034780347912879871335945646609675900100709363984133534944864524096612
                    ),
                    Fq(
                        32523933475797536418545694076687404354136685292462440737114243200207838237268752827953665114253037121898018110343928571753499465032995437277903238288419599030791282747904945511878322966184871321198635675866955350137459205578085
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            23658033642795692229410100651473336925871316308300166275996064759051298176659146812996939042400458153112050217306594648326156390799982151650646239486102887152072508197553931987119665774525364662726385311008011085766534656971953
                        ),
                        Fq(
                            21248999500327632520950653420467527287640305913367937670366581936929290377806159288672516147830739899856142672393518772342420372873277896685510390350600779259521489982379293740470376632210683846078199407699125805412623744181027
                        ),
                    ),
                    Fq2(
                        Fq(0),
                        Fq(
                            21556070235872291123524869787302508656838950098043385938353245727085608109102983558653715230510029280356391574331861504129391448250761624102861879044555456636898345743619671670705181676229095433024425382825929497574256934181830
                        ),
                    ),
                ),
            },
        ],
        "test_line_eval_times_eval": [
            {
                "x": Fq4(
                    Fq2(
                        Fq(
                            4079073725926196408391514310533919069894221693921784943959344532553615502697182452035072235313356081029277600581288759410511791996538344874985304011927040591457292854121492647866643729572283322344075257389946678763367354545851
                        ),
                        Fq(
                            29142648459813727065564306843265013896226112559319418711880949792047454240274016836608787584071965569351126476401054197365694705544015552353537291485945274783982793626596179648769254564555910065650924974940308509971998890536607
                        ),
                    ),
                    Fq2(
                        Fq(0),
                        Fq(
                            4737637526441876386270243327515971537423936091270027267698419656443613785898411853853348003384273721702706663420542933874020490936489356191184357527310954000814288418835516752507475790577491525139199244109997098156164847902627
                        ),
                    ),
                ),
                "y": Fq4(
                    Fq2(
                        Fq(
                            37005597074136204092284070228409835970351645802917872984412620455570601171253917099497357581615254067190216069802409085384797006736891430622040693161887736596901319431769349745338665505861622712393889583451685313192049685232825
                        ),
                        Fq(
                            12236732391978978900708921517383101694893503679322590840976861349787910291575792981557039731212279691981307381708178545255906852877938672938501810308560060676917567561648458273488633295624683095910023015634214825332218587950889
                        ),
                    ),
                    Fq2(
                        Fq(0),
                        Fq(
                            10371989074739463176862040492886525497182352790670310478560798528787636303518476009738931624135787633299943474675709072014143806719688301116212576309174467170684018981638739506361762641128967479615069630743825938850070447754979
                        ),
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            31653973809517101591087809717041841049399181645554078647900121474690044856761086541759694655670071057927211107264824248465308333287020621231631931193552293126337192085630496038128458798070363940128983775566511369754721970494231
                        ),
                        Fq(
                            30370385978854669933293074721249634911415003036606688706698194287955839576761830452481468522488654109351538148272774498060360022152860062335438433827690762738384398031477091360896197500198122005191941389847059433071459644594141
                        ),
                    ),
                    Fq2(
                        Fq(
                            40909140466447579317874036602290881075443053206407420943896141456641405480433083556869684440671518632125820299089308684593921280461059435408314692105080589223372872570533776632347533332832335972434978363279910905037451023793640
                        ),
                        Fq(
                            6649302701200441075152897416208688963029201243853699794970514249526210192235541051510119932882338524147659374915774302427544280005256324707660314069532756327017269375471843774508245456388304373909111060667345083388002365725084
                        ),
                    ),
                ),
            }
        ],
        "test_line_eval_times_eval_times_eval": [
            {
                "x": Fq4(
                    Fq2(
                        Fq(
                            27294660216373057663244742559207291141596463997361945171995724060922065239699590034367133612804132617726291414012668271915170701869201093207595066790362957132032277251545079034887122385714569680052435807137369021915536364533341
                        ),
                        Fq(
                            11573274395146770069821931464763978270581184326178736670962765598218665720113305527784001208393947137036842812858836343255342016456270656935204310840565571871485385890409053870393039965855504913292527176390658412916730937817928
                        ),
                    ),
                    Fq2(
                        Fq(0),
                        Fq(
                            5901542181326928256387702115855971646145686626398520953039992525895346848601735338671578481902929311706173305095138508742872504758733187499297400438741866981163461845554692645999083236413892187845515208836794097080651450323223
                        ),
                    ),
                ),
                "y": Fq4(
                    Fq2(
                        Fq(
                            2419065973991984450696449950963216644938085487951587861483335680382764602534275095289654846511799883755638409572051374762617664764472732500148307794441731938793491410036479993895140557989837911837542836565116455057926348683090
                        ),
                        Fq(
                            26088413572320866176581420368153477562580556043153501419328582538603815907631168134621959801874414805409119004410367763110677833889975632870399963307386871458817408196549996815740011943397347027705304094852103806955367266662564
                        ),
                    ),
                    Fq2(
                        Fq(
                            41787448103797153341123042339684889992154321724846635358655236188503516301758261233191128386714931758274177724308688948633508930702840693589834884452553746399459431399673850446198557193288497518751189191882462929351225021228248
                        ),
                        Fq(
                            22208872406573968198340331197062786575130233149379080536682563327176184529910391594950765617523606308542775486809402313395516488968368173842278850447878749531759130285003095693123349893086777780904861202252439582914093909044444
                        ),
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            39489415873221668989062212588502778240068333764079421303362196731530738569808400652503153658780030993246877704436474727923922823068234427431055817780964290761030453311500409072629855132135426754642628924531744456916477210522345
                        ),
                        Fq(
                            26848587350175390510187169835641585525282593591395004156459066020903262264860022191310689101858163801621094914629313366768673629068443791073022244912649636331975656668122057988638892033215127783582860213689117201996236429939758
                        ),
                    ),
                    Fq2(
                        Fq(
                            11549828771189256130872599956746378283796049885885594753753438229797553174303292636576279104820196460813881875346934335891539519930496595796862832264250724985758104594674077094205728526448696896989981190426581488427136054824193
                        ),
                        Fq(
                            15263942851041318364831262719658168473311562450934125173525074361549611137199259647742981138508030236037894643893955960742744200638160538292350290361958015591240196182161310426739284185494743508976019561384748325790176807700705
                        ),
                    ),
                ),
            }
        ],
        "test_miller_output_times_eval": [
            {
                "x": Fq4(
                    Fq2(
                        Fq(
                            28178942176828587079640045974267484919727680719608071078576606184515173889711774895681903586538464891293449390705622180757498132698600303832749946248833765275465598472372810623769778438913693349997944258466968315584554541072854
                        ),
                        Fq(
                            11654555973893062669800337324068772775060039000648357210471632599796883715258988992454787577855652865643288352283619682145353454648698338034395183572750967810161096866187392883755290432314251884403873177907837724564058119297578
                        ),
                    ),
                    Fq2(
                        Fq(
                            11874207689824324173617013982503635762716864202677945751557137310443786880216257928211648244419777881535714751674137404473656091031583443274229200099783803506757436382530754777301052664743851859844308562252194042207280454263654
                        ),
                        Fq(
                            21530760460463429810340907818310833728312865775863717799161804296818885245556205678210803881872009513260745178763746836265881249739606019902116429457186592305345861641621706561224358500915147539022436558199279042491076024224233
                        ),
                    ),
                ),
                "y": Fq4(
                    Fq2(
                        Fq(
                            31522200541747485125702527730997831264279849595798417674286621994058308449557092616730540283185543825472354832471885526587404635103012891020986098269042398189110855456442648509609814260502194650608883259291705383705287789930861
                        ),
                        Fq(
                            39644697529017271476628660967361570134046011788435421989976092502008997806536429003207897781752713423782769715528633118923010176342899672227659853974866109084852456505076599034308990747564875313031764558180393160399120433800836
                        ),
                    ),
                    Fq2(
                        Fq(0),
                        Fq(
                            29213702017789334403167445526464594244375330469719524500855959106470731893978074820399024853973057523361846633063246107408081663829120716928031462838049288362360547702575798140691907348056838360657906866659229521904778107491083
                        ),
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            17285642193308452964507349946849452494624214565047825201629297173502868023797197045269164227618079142132948646385649291028940250901981709216286015603222953715290389632879069535119678321318883399613899772520857448493405351359641
                        ),
                        Fq(
                            23388517612250027580959796961896838334684319808237821056797421370870244904453406869063124754898288127069355496801910507500069426986210005353680131124935799610337813875167146639761248373271831641022590498651890660215042408300587
                        ),
                    ),
                    Fq2(
                        Fq(
                            1623052767262941404496285972387295021329163877756195065084372718957829862524838852194046899527884875763370210991208474859192766437077230916474616535054849612381838568657976930816393685205774775353953562065150311659222863740747
                        ),
                        Fq(
                            8969458707166479534802570269181684158238542611660661777113424013897198296188396828630851915430456886102648702319743277895453434119723475858611306929186680825185751073602175769692904600721555407107675331924904029390240874311103
                        ),
                    ),
                ),
            }
        ],
        "test_easy_exponentiation_with_inverse_check": [
            {
                "f": Fq4(
                    Fq2(
                        Fq(
                            638017204636423660911430627874185477664089158686744942055251674959062739088271299720613486501703933266920628539988379933034831757490375424028032056424727217937070634975373070619593774113694715692580331305753157958072971934224
                        ),
                        Fq(
                            26913285465664020436794955310814105946967431865450462523128561613738048643283691469858776962657921818043566093669041972297931226923477447855536318893112102999998832329894245273358834867597192599694453188041513344385008406000262
                        ),
                    ),
                    Fq2(
                        Fq(
                            31584822698745864664149465851273832902523984740201279858485443148565582324592240499222517096421256611902431898185021781728054194900864645437707475750898374837519477785012590289693527284325637089784251700735851485593864049473935
                        ),
                        Fq(
                            24008691096353040736237239412728462055070379197002351916945754895943001001812044177505028201484148094333273843333523391937075807911514282852563444254830043620597065640225973439364465465845038843807179772247818014549892462860988
                        ),
                    ),
                ),
                "f_inverse": Fq4(
                    Fq2(
                        Fq(
                            26251209626743395482847331943638855635031661096218574105093204925645975370361179095963646222859315774544718652972599853801680270912087102842875500785795438076493464344335378129557031163186396584923651286183327995529878775685139
                        ),
                        Fq(
                            39664658327642741267442938276134060624392270472345850849888910100240379097295613331674315421128018576140341848220885283071022410424127269017289844952092224587045381636288934696278993996627598512764351146163585255761214905208243
                        ),
                    ),
                    Fq2(
                        Fq(
                            19649772344182307011208610841891427228437640504804797139901015402053349940197344219318695376778921712907951432570996190807155536267357861524366936180668831799771028365684346579121849679827088631774145210742930894077385365643799
                        ),
                        Fq(
                            40385764166315730829973865612945586633627980053081048180030329320358180596777520284468047380178096093413519340374137980378671292122163739954696630630510113287599685745301664043090324541046536615886754978322088535380878624437486
                        ),
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            39027625897711580819529362543261392881833877713562424797880884477377373709762328134167961687353687914886411478436640097277766594976166175968019296529356447549018265359359770936457452481270810765854693922194654192370716147524102
                        ),
                        Fq(
                            1973256765802616293354091999431313822800263449239940799333655417741822697541787572920271861564909427866307230470477811534248822171765439140742001942001518103970369736265348138637870431983058685636703583934941860011672058810180
                        ),
                    ),
                    Fq2(
                        Fq(
                            9798167772671053421305359741235860031837675579613766012764826232312452689583217778524697621955261412811516973797357460166535824167402272390480903939610332519482032386753897589008543394826513344397837718965682465356898146052270
                        ),
                        Fq(
                            17678777305329781100221095903221791711800209165346903792762164907097761862947383980847460116196845167700955922032790433341045528267942748754807047473009391074639977177359968049267869897958354066063065202948552384997173814975907
                        ),
                    ),
                ),
            }
        ],
        "test_hard_exponentiation": [
            {
                "f": Fq4(
                    Fq2(
                        Fq(
                            24398720312681029714217834686710328091199523078803563392324587383355106761689229713772015100260566707014141460424793480380807175652882478841743821330993721543433580203838628968782935486746811133009143368713659620900015959385900
                        ),
                        Fq(
                            15795865395276194001064802601396094307900836347499744955466856581918635866802430622167731274523217724755154089957801153882155163724602010898761603315102604408513257911409161343492125439138507108613338433898582342357622615231613
                        ),
                    ),
                    Fq2(
                        Fq(
                            41274722940530568765594209579886072798639533270838467419504401245312428095574758560044809410695153302432816999604343711870934330534914301968623843437365559422921163183653910562745293077120236135143905892436670404761054150440653
                        ),
                        Fq(
                            1224904465151141310833898208476223667515801361217546035412476600789069033589750714905286551251867975305192033442473070593041051117861908391860454164215008815314516127981433459271225426793063492470263402834438172205391830566112
                        ),
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            28864788090433884444676301823097693893933953784893695067045834895366939262933337166174616304681878729025590828419182659900223729630684538345488195525816248301691997121992593244185119282210177869104202698575587113747989578149457
                        ),
                        Fq(
                            38949028626079577020447820727019209947496093266171220171617262540615201617384579875259860175407565226648346061603909303010083527253518164052921307152573844934476382361454095088538723752218807325468239773019401865225973765646230
                        ),
                    ),
                    Fq2(
                        Fq(
                            14870745018118211879676213616802525737243467966526103056525040704064084850972566106136850877489811149760673715821655069932485760304931369012627845095090074571432651280731657161234740304933354799593039619326179336414606349768037
                        ),
                        Fq(
                            34933332647106340928363341902888387954397934817633795209895340323216224237070065029636386605406976138146072747387648328181901123035610644079518001610182055024052103442378167220129768446108470546160685348201816744562001280963641
                        ),
                    ),
                ),
            }
        ],
        "test_miller_loop": [
            {
                "point_p": g1_curve(
                    Fq(
                        19326698323509002998944973398822520051563555964203596418830543520584697290569142335586419599720972812674898469453936904950396393007729246574253785403602016322980176753930861702910082460573184733619513399632900330795519816148867
                    ),
                    Fq(
                        3029335385943847164898937403872779420817094861560021777566427100078026801426710076865387945100640487393697761419252447594302197336079918043076509088607636686115269957277647881962938406019888321500148097438726285869301240196763
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            13283806576284566187783649192966806519588508705741233581612552280550996595638968728953616024361761669170032393327606469487983417132578220258912273495965688828467827577181870121622309740377209120723837701659136966076221262796795
                        ),
                        Fq(
                            4958348343233942155408493335559792519080288433748321926304374211902210055624879090073428075887273341876993785711395963139866667408060379915249781222376155567998652263869043627488763772645559036092464494776136985450581383945451
                        ),
                    ),
                    Fq2(
                        Fq(
                            17535760647678058797868281710017472878803704024442884592945023440008882038656476081421556334037170908809562572755671826823464941493006123803342925185957836984651301205967652355006641498769167521829453626969218318583036846876933
                        ),
                        Fq(
                            19681577407713693255267254226296639574593809413938400919889012397422779490647631161318232235267610205446634315041890879566031668162709493882083489483114772636773286738117728870712547456355650272977442832918853946006750053012729
                        ),
                    ),
                    infinity=False,
                ),
                "q_times_val_miller_loop": g2_curve(
                    Fq2(
                        Fq(
                            28614684391634387214560565598273830608582201214212715490170950640474356216932138044105277739428577252248038578560647316626370309397006164942679332226047437640463576770767970421385676587366253732996790350033004299226893458892806
                        ),
                        Fq(
                            4958348343233942155408493335559792519080288433748321926304374211902210055624879090073428075887273341876993785711395963139866667408060379915249781222376155567998652263869043627488763772645559036092464494776136985450581383945451
                        ),
                    ),
                    Fq2(
                        Fq(
                            4406571941439513300465116280380893320111686936725646462027850806184601390173380901358879419166376189782715320485720051895056253551188284452801513148737900426760903986096595789184144139241318540621685526471067239698139378941413
                        ),
                        Fq(
                            25098066514632092836831721668894426802996202538745320860235252729661145234078048440118180778267530322733031480447200406533744497058529519438513446218925833377355389492092038892980301464843109940382235575962893312589270810434874
                        ),
                    ),
                    infinity=False,
                ),
                # Value of the Miller output, Miller loop computed on the twisted curve,
                # with quadratic denominator elimination
                "expected": Fq4(
                    Fq2(
                        Fq(
                            27782992996082742405400833617076898031416662833504017880678808221290800302811330622426082153562515938643285563096465966452513669643914011304544342035297178818435021885177288989258044616100403521451047689493616748633313374020878
                        ),
                        Fq(
                            37208658779627406066383216936509277925629041535766085036657451821041175895000842240879167084974417215294614103142163306746361018604119608535197565146625541008431897280361411749938534398780179793494296948388018019815052361838678
                        ),
                    ),
                    Fq2(
                        Fq(
                            11834732121105472011105314285599667628591625058461804214589633302616284189172331068375091923951692962638248618792385005950982358165905398418997580017040942493293275008909691163342617977992420873971160863626221377819386973839949
                        ),
                        Fq(
                            5203745615671052001565582246884323430825127955425110016953227202542665582770856333673284379994522717096531048274535014376062030134331689607567194008942294597211308788287707333809014739964167048213412029978814741260197917611961
                        ),
                    ),
                ),
            }
        ],
        "test_single_pairing": [
            {
                "point_p": g1_curve(
                    Fq(
                        1833033138314188790955696626454410652156156513898272632554219496807702919122653093794610777127926376898889872382097966137716273898491910005676429347011691019450729405691544719125477315635168689273826691935665090683851306968702
                    ),
                    Fq(
                        23575390795159077034665466047570654182724566796781460972021329527041437476124316413367778433372110500274703923108147964541405045319708174731757378875572998113792729775531614459432128993082723419597483034264247879163628125274449
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            20107436964959809980653133173541792848112045037324804946356753271685258150743719384967546950233618137269588220899929738627908809619449875695062764578926106005275719195038259100876906790653582410788971212283724427011351068840051
                        ),
                        Fq(
                            37485551346895489843536403783907862109224710907840269167195113497434962420827708457143399235195718997327888706269779231791218985819061368509868028393075284887523366901720211932539951561694399546789879865129381488615439450079339
                        ),
                    ),
                    Fq2(
                        Fq(
                            41134844726848747772089967346089476828439730529306475065813366836129563802740868824464048684631456952861251950908509507699328568205995470355943676813167859609381924379065995051618446610586838089085620227445465517515010432778956
                        ),
                        Fq(
                            39218501796620807257210888826152163769709669772748327944445927286107690502452066911571803616504307384523822045087998745009809880327736867897513155575196708105066098286646950300364015293341748581406068238451519750339628240807569
                        ),
                    ),
                    infinity=False,
                ),
                "miller_loop_inverse": Fq4(
                    Fq2(
                        Fq(
                            26071980490799851735629596964854544027999812721916512389933470466714171517887150611719270952961349913494213782887662665348461146752530724436815899408564674437491712985253176157607761961429066912811197217310818039906900968379009
                        ),
                        Fq(
                            22232312378783336677567628712152908977124883939897694002838352951664333509926307290554698752962359073221572616095544554577603468192202161067673843760797758557390699336092598890965610637129897330044945436614208299011032271206560
                        ),
                    ),
                    Fq2(
                        Fq(
                            20629363758566333619893742459558939879493955036273610126487732475215538415568083851320462814125901661397023633459804328483730298558010127581319719463003324738040488147699806136297454746412408813734347898171042265480539678307834
                        ),
                        Fq(
                            35708166473336708225933024151166419664971977870343527414481673246303112550774262025320377161334794350960645352051140694622767630540084664952292985856124136661213549798303397815729993900746251586352357988987676444125531085437479
                        ),
                    ),
                ).to_list(),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            39772958920984780044001765906805906068885393441743483828845082896017221091957499543334022037130498007853945845334423443272662672251776435825826072879612312646681455553324046625426598744711837231801400246597922636578262971016642
                        ),
                        Fq(
                            17632106408161696680381042881695899027718254036690794341167041033855473294065579069255690053101085511344507791047764853279778535706073956681745139001457070501225417210396913833799716626400268434039420861811111848102740533452267
                        ),
                    ),
                    Fq2(
                        Fq(
                            14078781706679807490258092070353770636978058688081358410876430008044429318520520812699410585478184534089180524212184333266011270064213627777919515110007371833382779481867084491641737270999558037247687961301688098379478399693720
                        ),
                        Fq(
                            37694965660743527571318239637105494344756407332534592326341196260936559685437872049163164801834515655386335803278372777450709031314268670394775264445452316061115677535814150684491678942074526752937025757462551716725961792282560
                        ),
                    ),
                ),
            },
            {
                "point_p": g1_curve.infinity(),
                "point_q": g2_curve(
                    Fq2(
                        Fq(
                            25362111387247616179495672310472401015160895544535171257874707541526625493446650575265143270208159131272132273907305452231900849302579583565131281252211784736388328463510960221516423795436807301735404187175718633645553556551604
                        ),
                        Fq(
                            22788038400811154610748408483771308338912464698540440107263251786277082095114023403438838968567340564964421407063700094631279445670140595976461868736778344960622687568659239816702399379836121860248141976449355627977198710362188
                        ),
                    ),
                    Fq2(
                        Fq(
                            18382867387011930653950336460996384581558391079324683704225859070591953773905262408692584190150996189267192338120646227300701817107063042771253078675148414611500972229398772478214221894920505672014235255065725584684629612994497
                        ),
                        Fq(
                            8339638073192077394234252240420112858673405211738729412202393975602120551410105441754115366883334241486445053643468217897070956457194464765777052575893773813543408702752991691036981509056735980453935442892463420856668983600024
                        ),
                    ),
                    infinity=False,
                ),
                "miller_loop_inverse": None,
                "expected": Fq4.identity(),
            },
            {
                "point_p": g1_curve(
                    Fq(
                        38789345272186400940282765202354361417131221444260534930353159484053883045174350452461543372612639767886147945452046389632760478474417737151336489657307910472031442141199324695553328034671727052141287712142770746429002298003004
                    ),
                    Fq(
                        20325966031831394281672895984688283809038125425690573112256183435917011524862850574014914532900883168961362559114919339620092152771933147985499183963568199822858460505213278294383736989802997792098612527746635385075238164216453
                    ),
                    infinity=False,
                ),
                "point_q": g2_curve.infinity(),
                "miller_loop_inverse": None,
                "expected": Fq4.identity(),
            },
            {
                "point_p": g1_curve.infinity(),
                "point_q": g2_curve.infinity(),
                "miller_loop_inverse": None,
                "expected": Fq4.identity(),
            },
        ],
        "test_triple_miller_loop": [
            {
                "point_p": [
                    g1_curve(
                        Fq(
                            39194798937854579957367103569263113395079975250444772094412416589352864242794106199817636736963377572628465964899629794829912748638356845960305582826714260736476095725111637238587415247714329374990126196176379426009686462985467
                        ),
                        Fq(
                            29339461829895319458684544351067873951995673129794019817892616965609034606632716194576666057983723396817697416110370790574399331840601474726020192683176043450462993376381960776678714734639136525982826676136452876366409801948935
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            23415259129422719688900291964431278315959524720278055337149930907347894040144351424322386462344793713674237258999143485929343732598247985717242298931962976199261948245858023580017783973253610433659987218541156880827842958795672
                        ),
                        Fq(
                            8346580571696146142092574817357197009682464816909355259248948692112296026933143771901746466146152292117769037145216565726744953817349814943293739780318445550171086456067902526229079873847615897063690232963614205434622627590744
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            25782310264574190107665550386037851852988788400753096812524801673071495227797942783266223221163746749542630802589348844170568771330821063985402970076262798244971931790359192760911052027198570905134417005011648110348400837170140
                        ),
                        Fq(
                            12998538172763009190452374727783639837544829648332688269543106038762759171686334120557076619555293839190483113319292823968929615228607280540236332856218857743828480559663166645022391271483619912872327110633133236304650517958793
                        ),
                        infinity=False,
                    ),
                ],
                "point_q": [
                    g2_curve(
                        Fq2(
                            Fq(
                                14650910964986554014257122403737523708323786776494604499252071493052760516360427844281731609017579409644998849211134746764720735422203930491504451510519605527928559718609167306307145692707125762064402868741092073052048591460024
                            ),
                            Fq(
                                15903431151882534201232238317833353481685392631279403770342017014258359174517199179478780725487023663174654499888764317620593112190742057701947988160801263983351756216517969221800528061314447477951276187717091274043525095739111
                            ),
                        ),
                        Fq2(
                            Fq(
                                27866071831265396088163720123015694213653641835881725543989670390499237290997186459038456119922673096309343432742498600271198070219273520642029081475195153091978915646919714385076585613713039293830962594253021710152829909758816
                            ),
                            Fq(
                                14980342976671019419948982524108867105268347383664649531134319091118318988085957533752786761855293611951234443141571560608111986894585300602793453083830251863639457942015741105041790400927412100532539471046585548979797487554835
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                36837796927968624423490623586682397053640441570211241038871856505801478788443641615926990351071515494339103502808435479508872243591299160125387002319634895831578248785853819895137990269509372676498149836389726632048111201630043
                            ),
                            Fq(
                                34401042559662019279804145810676881446594018532918500740309951408907155528626563047565420074910169460126300873993738561354739095159481823643216005381575219796110504942045035168960840446323332001538849382229691521162835698821793
                            ),
                        ),
                        Fq2(
                            Fq(
                                7178061296649596079325360007295339800045641628694461901704989743487351556218301564142355818592982567296850554295423198259240466366336611478643689043375744136647098813073690733502367027663263307775416543932319606983851092756922
                            ),
                            Fq(
                                11130377426001702055594470097030002505796702943063234783763518462435666915234960526221757237290212462734310778846774588405849543463938146455123184942821432288315577124349549234084243231058438839721173369185932907448372298449708
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                34416990245619994945624082538198123289478281901456481270192878850909554379824990498194804461695763358757954872669092983511387521976769390161245841821480867611411084362603570990872225346665345121946119464630136613533011796772103
                            ),
                            Fq(
                                22649267299121969447619628215790840268141715583212167230554124515456393333656278920373951436988985907325161606353720747484255275961986211400617220675041745338619365936670965634220755248279680844981276843097450447302025521199055
                            ),
                        ),
                        Fq2(
                            Fq(
                                6462810909920217323268604865492849329986681019863723734430012093976536698553570448310750915652825929933114821308346675803443370966332952678490696512208027081640176558949015712752453323062055641344531079879600169494596467761353
                            ),
                            Fq(
                                40355259163355236707935280477578538180714154246242216227815318723615898306502729163809983545028884552111858547227689688854028831097525859972813556341002050314372450361334600862767808068656612661664470555057808462384201601867946
                            ),
                        ),
                        infinity=False,
                    ),
                ],
                # Output of the triple Miller loop, computed on the twisted curve,
                # with quadratic denominator elimination
                "expected": Fq4(
                    Fq2(
                        Fq(
                            30980770179937938014059479973618078299702771644237498701999546998848067820938830498016406093835687593352849733141545829243448267215591755251170230598758782419390579045293894278600628506966267315056573658599244342886913904747785
                        ),
                        Fq(
                            14589571494325280841918622662688625184092878222422843519780036606250891514901797622392755488230340973399841079059764494299112241754248906730095967215478563056214577121305895113662757244127963962329291102115137664060619918123754
                        ),
                    ),
                    Fq2(
                        Fq(
                            23707357030333232559739339685514128432408247236288760524857001323999078642931350141099833339961186176557317894714764557312347380949639870978903649716646248604341106938711910578794131031748320589783514597033360042575581180008744
                        ),
                        Fq(
                            20390790977141611432197140394835589632267757979129036088979531109685876762396616634396911890185967698041263461327552862223042664647423940007796259194380784872210766993424633553887347441113802779959657622631084203682082732714696
                        ),
                    ),
                ),
            }
        ],
        "test_triple_pairing": [
            {
                "point_p": [
                    g1_curve(
                        Fq(
                            2795065682308053001837030257198521273474676952051025551375945911537972137384870714717602218107546917412284213090052407161397245091899584174707321979644614202982287358967165557382823014476816880281781931178234419894988784963783
                        ),
                        Fq(
                            39274468072881692258147668430590735920892344032977896528628453934665035786807219718578498600825019929013801071193060014585486278974415224167481333354791345067279875266696345235348565979559937733808027151970136197197141324107772
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            26575457779049752077104572547219931870655578631954878882488816569218172464110769341584429449797800217310729002665781440065939720560813094899634310550673043832158715060788829035324710943870107252901272118234910354743312379321878
                        ),
                        Fq(
                            2420395773550807079041063600060977670301260804532287327785525450987870199933136884785162637062019019045279679151497575904003145357773230463157672891113139244758371490711688732454733321467051476734571833939175427927753225392229
                        ),
                        infinity=False,
                    ),
                    g1_curve(
                        Fq(
                            39857460690200346537098008743430918632614278167246750917466025972722924212164241853906815159328959070856820861902232557987288481849624496673654567493631385987548037677339881546688082209507179699044662542535806518705839198655570
                        ),
                        Fq(
                            10777409270092290423468300600166971976016295003080343522243125764815296459502871669551230698726090005302304113157784961959581951920526319175773444637606652361720965623605024529939323182264959329815135608978599560965572606061435
                        ),
                        infinity=False,
                    ),
                ],
                "point_q": [
                    g2_curve(
                        Fq2(
                            Fq(
                                38467608799473155707738340801268815586207638477194523209491185067275902938609613764220846389368479923945334401369509319573650215327025169937385900209838821200308934950161180565369855792336098563946995441312901085206686807525209
                            ),
                            Fq(
                                29948828330662898723305910106249679311088106258296868788277541165790901258382891061956623733332914556427381363801030320729009090743639977152645570478550839551280381152660373577069727154730009741366532118242292988714537509276426
                            ),
                        ),
                        Fq2(
                            Fq(
                                897231537458562843314595800733427271269072591078173623952977805277935197189414774494460428081371048621319936669852269444096370386870910913431870274310002910018654018193775412773962433173162343437086738288860664409658919324045
                            ),
                            Fq(
                                9390636616770219503524481374725142229281176775391596751977034675339371327077536146070200428222743211155161451175531565823477086182364370138000688025377092925560089728317465153846191036369738264552890567426022366728550307873477
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                37374345432891161297742490973284203679570827643684353201226267056440758976205061055783748112084675528354819462801126370417967228496029560823000552082104573501366640703275535929619860427779588906306030886914971645688479730583788
                            ),
                            Fq(
                                37468554416650384794922316658840524044981658161369999529083505204692253473844209846485242243882941998980171915290987282835187955101784901526129485020354679072313084336065083794379419497590478965103144354582294981638415811042070
                            ),
                        ),
                        Fq2(
                            Fq(
                                728548688000702399330518782946803958573580478734270440640250968028985720801412254890844596111935567486583502368352882868774472434828873834246587936501628710434091472804235578895213818716059570609525851415202427313400401780306
                            ),
                            Fq(
                                7389964912242935652394092148785627348368405621533457457736363032945494819453420677571494554864330290712058607971529497567393745047980291644717123519378440737118690694455923145247591612306281551972580126864563915733922248166857
                            ),
                        ),
                        infinity=False,
                    ),
                    g2_curve(
                        Fq2(
                            Fq(
                                37478222582054134548804272335308319600684563485962657154496560608475804482593076215024414075222750842187693477776748050843782623259673892061118471789349044180297315149016764943665965032129461648725269597373417950725172343633583
                            ),
                            Fq(
                                36767624053997513548555169076822533142312872695571383427017733720490284487797628164700692621925339795164085686172590979156597234917278150247278889175549888803397242261675696925938242059310720565140347344228633745973624704437021
                            ),
                        ),
                        Fq2(
                            Fq(
                                32743500738839919616713435773309380194655842235561142689745678416747580429658470303962987878583236620619022128327429706495742247516565069134977428693549526113856100268012381051241885651018420356295705110240672917275411579675379
                            ),
                            Fq(
                                7220451664915313495008750767795654139307609008291623500605713622790934433270295203804734543789602641006571379807441501995753604844806746399710960102036944053085733889497464400785101654330188505573209204894064699426926268924189
                            ),
                        ),
                        infinity=False,
                    ),
                ],
                "miller_loop_inverse": Fq4(
                    Fq2(
                        Fq(
                            28890677655748347680436355040535894035727966348194176476567617661198069379212869176678838921207843188397160789208029363989511796278141741444630333632677930662848206968880141454986151015441103039335520715026429396547143961740554
                        ),
                        Fq(
                            28603387542387253289221102112022272232402472071208977764091078019550299455304046073601202162372648614430133785116286052386934220491161386672647506716889895742438641527506541658895328816370305374882064328951927944963951131580382
                        ),
                    ),
                    Fq2(
                        Fq(
                            23676668232824120621005216913109092749912378307670282075452023578683365316391991857664122588304671657412389682833918260092370177667459676035982162573715577779762246985108177141759130928665205582554261392502407834288364069715369
                        ),
                        Fq(
                            20210398448666576295928594005046927816006522191653856243763942609434487241238452241112680534487472024190882473482246218969819064663072225203326107184917213743302234994512535415446433413847821272887624647318908865394895357540727
                        ),
                    ),
                ),
                "expected": Fq4(
                    Fq2(
                        Fq(
                            24334107866980265138115163041256483971261412632113264030187822653872265029091991011947103748176750622826700496125183250557220715991325023206298720140668480242582573671375481724800041716838418783211751737432523460903419271835922
                        ),
                        Fq(
                            30175369090371122220228044305706940963969470004558864884766620275674454476497135697199398524785311673136574923045713930872088811432897495636650324230246889619732832679385886002468736946674481236899688650352821057888028280339543
                        ),
                    ),
                    Fq2(
                        Fq(
                            16453005424780900290702153737025373573896029108212546541988989523646237268903674547596237508981508749995969369524994531883633776246752832144770561877187276724729107918792221861394989668133716033099276004169036296526202831444918
                        ),
                        Fq(
                            26785074782101838228247778663303343221551356734663541565871646444219636975446977915402231339899852813821134078540890931624661600847771528252472250584902595766625769247309354336150832371838212271610688335287194468196938165122873
                        ),
                    ),
                ),
            }
        ],
    }


def generate_test_cases(test_name):
    configurations = [
        Bls12381,
        Mnt4753,
    ]

    out = []
    for config in configurations:
        if test_name in config.test_data:
            for test_data in config.test_data[test_name]:
                match test_name:
                    case "test_cubic_to_quadratic":
                        out.append((config, test_data["x"], test_data["expected"]))
                    case "test_line_evaluation":
                        out.append(
                            (
                                config,
                                test_data["point_p"],
                                test_data["point_q"],
                                test_data["lam"],
                                test_data["expected"],
                            )
                        )
                    case "test_line_eval_times_eval":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_line_eval_times_eval_times_eval":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_line_eval_times_eval_times_eval_times_eval":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_line_eval_times_eval_times_eval_times_eval":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_line_eval_times_eval_times_eval_times_eval_times_eval_times_eval":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_miller_output_times_eval":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_line_eval_times_eval_times_miller_output":
                        out.append((config, test_data["x"], test_data["y"], test_data["expected"]))
                    case "test_easy_exponentiation_with_inverse_check":
                        out.append((config, test_data["f"], test_data["f_inverse"], test_data["expected"]))
                    case "test_hard_exponentiation":
                        out.append((config, test_data["f"], test_data["expected"]))
                    case "test_miller_loop":
                        out.append(
                            (
                                config,
                                test_data["point_p"],
                                test_data["point_q"],
                                test_data["q_times_val_miller_loop"],
                                test_data["expected"],
                            )
                        )
                    case "test_single_pairing":
                        out.append(
                            (
                                config,
                                test_data["point_p"],
                                test_data["point_q"],
                                test_data["miller_loop_inverse"],
                                test_data["expected"],
                            )
                        )
                    case "test_triple_miller_loop":
                        out.append((config, test_data["point_p"], test_data["point_q"], test_data["expected"]))
                    case "test_triple_pairing":
                        out.append(
                            (
                                config,
                                test_data["point_p"],
                                test_data["point_q"],
                                test_data["miller_loop_inverse"],
                                test_data["expected"],
                            )
                        )
                    case _:
                        raise ValueError
    return out


def verify_script(lock, unlock, clean_constant):
    context = Context(script=unlock + lock)

    assert context.evaluate()
    assert context.get_altstack().size() == 0

    if clean_constant:
        assert context.get_stack().size() == 1
    else:
        assert context.get_stack().size() == 2


@pytest.mark.parametrize(("config", "x", "expected"), generate_test_cases("test_cubic_to_quadratic"))
def test_cubic_to_quadratic(config, x, expected, save_to_json_folder):
    unlock = generate_unlock(x)

    # Check correct evaluation
    lock = config.test_script_cubic_to_quadratic.to_quadratic()
    lock += generate_verify(expected)

    verify_script(lock, unlock, True)

    if save_to_json_folder:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "cubic_to_quadratic")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize("is_gradient_before", [True, False])
@pytest.mark.parametrize(
    ("config", "point_p", "point_q", "lam", "expected"), generate_test_cases("test_line_evaluation")
)
def test_line_evaluation(
    config,
    positive_modulo,
    point_p,
    point_q,
    lam,
    expected,
    clean_constant,
    is_constant_reused,
    is_gradient_before,
    save_to_json_folder,
):
    unlock = nums_to_script([config.q])
    if is_gradient_before:
        unlock += generate_unlock(lam)
    unlock += generate_unlock(point_p)
    unlock += generate_unlock(point_q)
    if not is_gradient_before:
        unlock += generate_unlock(lam)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    if is_gradient_before:
        lock = config.test_script_line_functions.line_evaluation(
            take_modulo=True,
            positive_modulo=positive_modulo,
            check_constant=True,
            clean_constant=clean_constant and positive_modulo,
            is_constant_reused=is_constant_reused,
        )
    else:
        lock = config.test_script_line_functions.line_evaluation(
            take_modulo=True,
            positive_modulo=positive_modulo,
            check_constant=True,
            clean_constant=clean_constant and positive_modulo,
            is_constant_reused=is_constant_reused,
            gradient=StackFiniteFieldElement(1, False, 2),
            P=StackEllipticCurvePoint(
                StackFiniteFieldElement(7, False, 1),
                StackFiniteFieldElement(6, False, 1),
            ),
            Q=StackEllipticCurvePoint(
                StackFiniteFieldElement(5, False, 2),
                StackFiniteFieldElement(3, False, 2),
            ),
        )
    if is_constant_reused:
        lock += check_constant(config.q)

    verification = generate_verify(expected, config.ix_line_evaluation)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "line_evaluation")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(("config", "x", "y", "expected"), generate_test_cases("test_line_eval_times_eval"))
def test_line_eval_times_eval(
    config, positive_modulo, x, y, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(x, config.ix_line_evaluation)
    unlock += generate_unlock(y, config.ix_line_evaluation)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_miller_output_ops.line_eval_times_eval(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected, config.ix_line_eval_times_eval)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "line_eval_times_eval")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(("config", "x", "y", "expected"), generate_test_cases("test_line_eval_times_eval_times_eval"))
def test_line_eval_times_eval_times_eval(
    config, positive_modulo, x, y, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(x, config.ix_line_evaluation)
    unlock += generate_unlock(y, config.ix_line_eval_times_eval)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_miller_output_ops.line_eval_times_eval_times_eval(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected, config.ix_line_eval_times_eval_times_eval)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(
            str(lock), str(unlock), save_to_json_folder, config.filename, "test_line_eval_times_eval_times_eval"
        )


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(
    ("config", "x", "y", "expected"), generate_test_cases("test_line_eval_times_eval_times_eval_times_eval")
)
def test_line_eval_times_eval_times_eval_times_eval(
    config, positive_modulo, x, y, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(x, config.ix_line_eval_times_eval)
    unlock += generate_unlock(y, config.ix_line_eval_times_eval)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_miller_output_ops.line_eval_times_eval_times_eval_times_eval(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(
            str(lock),
            str(unlock),
            save_to_json_folder,
            config.filename,
            "test_line_eval_times_eval_times_eval_times_eval",
        )


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(
    ("config", "x", "y", "expected"),
    generate_test_cases("test_line_eval_times_eval_times_eval_times_eval_times_eval_times_eval"),
)
def test_line_eval_times_eval_times_eval_times_eval_times_eval_times_eval(
    config, positive_modulo, x, y, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(x, config.ix_line_eval_times_eval)
    unlock += generate_unlock(y, config.ix_line_eval_times_eval_times_eval_times_eval)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_miller_output_ops.line_eval_times_eval_times_eval_times_eval_times_eval_times_eval(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(
            str(lock),
            str(unlock),
            save_to_json_folder,
            config.filename,
            "test_line_eval_times_eval_times_eval_times_eval_times_eval_times_eval",
        )


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(("config", "x", "y", "expected"), generate_test_cases("test_miller_output_times_eval"))
def test_miller_output_times_eval(
    config, positive_modulo, x, y, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(x, config.ix_miller_output)
    unlock += generate_unlock(y, config.ix_line_evaluation)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_miller_output_ops.miller_loop_output_times_eval(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "test_miller_output_times_eval")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(
    ("config", "x", "y", "expected"), generate_test_cases("test_line_eval_times_eval_times_miller_output")
)
def test_line_eval_times_eval_times_miller_output(
    config, positive_modulo, x, y, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(x, config.ix_line_eval_times_eval)
    unlock += generate_unlock(y, config.ix_miller_output)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_miller_output_ops.line_eval_times_eval_times_miller_loop_output(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(
            str(lock),
            str(unlock),
            save_to_json_folder,
            config.filename,
            "test_line_eval_times_eval_times_miller_output",
        )


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_constant_reused", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(
    ("config", "f", "f_inverse", "expected"), generate_test_cases("test_easy_exponentiation_with_inverse_check")
)
def test_easy_exponentiation_with_inverse_check(
    config, positive_modulo, f, f_inverse, expected, clean_constant, is_constant_reused, save_to_json_folder
):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(f_inverse, config.ix_miller_output)
    unlock += generate_unlock(f, config.ix_miller_output)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_final_exponentiation.easy_exponentiation_with_inverse_check(
        take_modulo=True,
        positive_modulo=positive_modulo,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
        is_constant_reused=is_constant_reused,
    )
    if is_constant_reused:
        lock += check_constant(config.q)
    verification = generate_verify(expected, config.ix_miller_output)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant and not is_constant_reused:
        save_scripts(
            str(lock), str(unlock), save_to_json_folder, config.filename, "test_easy_exponentiation_with_inverse_check"
        )


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("positive_modulo", [True, False])
@pytest.mark.parametrize(("config", "f", "expected"), generate_test_cases("test_hard_exponentiation"))
def test_hard_exponentiation(config, positive_modulo, f, expected, clean_constant, save_to_json_folder):
    unlock = nums_to_script([config.q])
    unlock += generate_unlock(f, config.ix_miller_output)

    # Check correct evaluation, if positive_modulo is negative, we do not clean the modulo constant q
    lock = config.test_script_final_exponentiation.hard_exponentiation(
        take_modulo=True,
        positive_modulo=positive_modulo,
        modulo_threshold=1,
        check_constant=True,
        clean_constant=clean_constant and positive_modulo,
    )
    verification = generate_verify(expected, config.ix_miller_output)
    lock += verification if positive_modulo else modify_verify_modulo_check(verification, clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "test_hard_exponentiation")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize(
    ("config", "point_p", "point_q", "q_times_val_miller_loop", "expected"), generate_test_cases("test_miller_loop")
)
def test_miller_loop(config, point_p, point_q, q_times_val_miller_loop, expected, clean_constant, save_to_json_folder):
    gradients = [[s.to_list() for s in el] for el in point_q.gradients(config.exp_miller_loop)]

    unlocking_key = MillerLoopUnlockingKey(point_p.to_list(), point_q.to_list(), gradients)

    unlock = unlocking_key.to_unlocking_script(config.test_script_pairing)

    # Check correct evaluation
    lock = config.test_script_pairing.miller_loop(modulo_threshold=1, check_constant=True, clean_constant=False)

    lock += modify_verify_modulo_check(generate_verify(expected, config.ix_miller_output), False)
    lock += modify_verify_modulo_check(Script.parse_string("OP_VERIFY"), False)
    lock += modify_verify_modulo_check(generate_verify(q_times_val_miller_loop), clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "test_miller_loop")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize(
    ("config", "point_p", "point_q", "miller_output_inverse", "expected"), generate_test_cases("test_single_pairing")
)
def test_single_pairing(config, point_p, point_q, miller_output_inverse, expected, clean_constant, save_to_json_folder):
    if point_q.is_infinity():
        gradients = []
        point_q = None
    else:
        gradients = [[s.to_list() for s in el] for el in point_q.gradients(config.exp_miller_loop)]
        point_q = point_q.to_list()

    point_p = None if point_p.is_infinity() else point_p.to_list()

    unlocking_key = SinglePairingUnlockingKey(point_p, point_q, gradients, miller_output_inverse)

    unlock = unlocking_key.to_unlocking_script(config.test_script_pairing)

    # Check correct evaluation
    lock = config.test_script_pairing.single_pairing(modulo_threshold=1, check_constant=True, clean_constant=False)
    lock += modify_verify_modulo_check(generate_verify(expected), clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "test_single_pairing")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize(("config", "point_p", "point_q", "expected"), generate_test_cases("test_triple_miller_loop"))
@pytest.mark.parametrize("is_precomputed_gradients_in_unlock", [True, False])
def test_triple_miller_loop(
    config, point_p, point_q, expected, clean_constant, is_precomputed_gradients_in_unlock, save_to_json_folder
):
    gradients = [[[s.to_list() for s in el] for el in point_q[i].gradients(config.exp_miller_loop)] for i in range(3)]

    unlocking_key = TripleMillerLoopUnlockingKey(
        [point_p[0].to_list(), point_p[1].to_list(), point_p[2].to_list()],
        [point_q[0].to_list(), point_q[1].to_list(), point_q[2].to_list()],
        gradients,
        has_precomputed_gradients=is_precomputed_gradients_in_unlock,
    )

    unlock = unlocking_key.to_unlocking_script(config.test_script_pairing)

    # Check correct evaluation
    lock = config.test_script_pairing.triple_miller_loop(
        modulo_threshold=1,
        check_constant=True,
        clean_constant=False,
        is_precomputed_gradients_on_stack=is_precomputed_gradients_in_unlock,
        precomputed_gradients=gradients[1:],
    )

    lock += modify_verify_modulo_check(generate_verify(expected), clean_constant)
    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "test_triple_miller_loop")


@pytest.mark.parametrize("clean_constant", [True, False])
@pytest.mark.parametrize("is_precomputed_gradients_in_unlock", [True, False])
@pytest.mark.parametrize(
    ("config", "point_p", "point_q", "miller_output_inverse", "expected"), generate_test_cases("test_triple_pairing")
)
def test_triple_pairing(
    config,
    point_p,
    point_q,
    miller_output_inverse,
    expected,
    clean_constant,
    is_precomputed_gradients_in_unlock,
    save_to_json_folder,
):
    gradients = [[[s.to_list() for s in el] for el in point_q[i].gradients(config.exp_miller_loop)] for i in range(3)]

    unlocking_key = TriplePairingUnlockingKey(
        [point_p[i].to_list() for i in range(3)],
        [point_q[i].to_list() for i in range(3)],
        gradients,
        miller_output_inverse.to_list(),
        has_precomputed_gradients=is_precomputed_gradients_in_unlock,
    )

    unlock = unlocking_key.to_unlocking_script(config.test_script_pairing)

    lock = config.test_script_pairing.triple_pairing(
        modulo_threshold=1,
        check_constant=True,
        clean_constant=False,
        is_precomputed_gradients_on_stack=is_precomputed_gradients_in_unlock,
        precomputed_gradients=gradients[1:],
    )
    lock += modify_verify_modulo_check(generate_verify(expected), clean_constant)

    verify_script(lock, unlock, clean_constant)

    if save_to_json_folder and clean_constant:
        save_scripts(str(lock), str(unlock), save_to_json_folder, config.filename, "test_triple_pairing")
